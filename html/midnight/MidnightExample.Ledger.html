<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>MidnightExample.Ledger</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Introduction}

</a><a id="25" class="Markup">\begin{code}[hide]</a>
<a id="44" class="Symbol">{-#</a> <a id="48" class="Keyword">OPTIONS</a> <a id="56" class="Pragma">--safe</a> <a id="63" class="Symbol">#-}</a>
<a id="67" class="Keyword">open</a> <a id="72" class="Keyword">import</a> <a id="79" href="Interface.DecEq.html" class="Module">Interface.DecEq</a>
<a id="95" class="Keyword">open</a> <a id="100" class="Keyword">import</a> <a id="107" href="Interface.Hashable.html" class="Module">Interface.Hashable</a>

<a id="127" class="Keyword">open</a> <a id="132" class="Keyword">import</a> <a id="139" href="Prelude.html" class="Module">Prelude</a> <a id="147" class="Keyword">hiding</a> <a id="154" class="Symbol">(</a><a id="155" href="Data.Nat.Base.html#1301" class="Primitive Operator">_&lt;ᵇ_</a><a id="159" class="Symbol">;</a> <a id="161" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a><a id="164" class="Symbol">)</a> <a id="166" class="Keyword">renaming</a> <a id="175" class="Symbol">(</a><a id="176" href="Data.Product.Base.html#1109" class="Function Operator">_×_</a> <a id="180" class="Symbol">to</a> <a id="183" class="Function Operator">_∧_</a><a id="186" class="Symbol">)</a>
<a id="188" class="Keyword">open</a> <a id="193" class="Keyword">import</a> <a id="200" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="215" class="Keyword">using</a> <a id="221" class="Symbol">(</a><a id="222" href="Axiom.Set.Sum.html#1617" class="Function">indexedSumL</a><a id="233" class="Symbol">)</a>
<a id="235" class="Keyword">open</a> <a id="240" class="Keyword">import</a> <a id="247" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="260" class="Keyword">hiding</a> <a id="267" class="Symbol">(</a><a id="268" href="Data.Integer.Base.html#6052" class="Function Operator">_/_</a><a id="271" class="Symbol">;</a> <a id="273" href="Data.Integer.Properties.html#2111" class="Function Operator">_≟_</a><a id="276" class="Symbol">)</a>

<a id="279" class="Keyword">module</a> <a id="286" href="MidnightExample.Ledger.html" class="Module">MidnightExample.Ledger</a> <a id="309" class="Symbol">(</a><a id="310" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a> <a id="315" class="Symbol">:</a> <a id="317" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="320" class="Symbol">)</a> <a id="322" class="Symbol">⦃</a> <a id="324" href="MidnightExample.Ledger.html#324" class="Bound">_</a> <a id="326" class="Symbol">:</a> <a id="328" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="334" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a> <a id="339" class="Symbol">⦄</a>
  <a id="343" class="Symbol">⦃</a> <a id="345" href="MidnightExample.Ledger.html#345" class="Bound">_</a> <a id="347" class="Symbol">:</a> <a id="349" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="358" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a> <a id="360" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a> <a id="365" class="Symbol">⦄</a> <a id="367" class="Symbol">⦃</a> <a id="369" href="MidnightExample.Ledger.html#369" class="Bound">_</a> <a id="371" class="Symbol">:</a> <a id="373" href="Interface.Hashable.html#155" class="Function">Hashable₁</a> <a id="383" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="388" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a> <a id="393" class="Symbol">⦄</a> <a id="395" class="Symbol">⦃</a> <a id="397" href="MidnightExample.Ledger.html#397" class="Bound">_</a> <a id="399" class="Symbol">:</a> <a id="401" href="Interface.Hashable.html#269" class="Function">Hashable₂</a> <a id="411" href="MidnightExample.Ledger.html#183" class="Function Operator">_∧_</a> <a id="415" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a> <a id="420" class="Symbol">⦄</a> <a id="422" class="Keyword">where</a>

<a id="429" class="Keyword">open</a> <a id="434" class="Keyword">import</a> <a id="441" href="Data.Integer.Properties.html" class="Module">Data.Integer.Properties</a> <a id="465" class="Keyword">using</a> <a id="471" class="Symbol">(</a><a id="472" href="Data.Integer.Properties.html#31484" class="Function">+-0-commutativeMonoid</a><a id="493" class="Symbol">;</a> <a id="495" href="Data.Integer.Properties.html#31618" class="Function">+-0-abelianGroup</a><a id="511" class="Symbol">)</a>
<a id="513" class="Keyword">open</a> <a id="518" class="Keyword">import</a> <a id="525" href="Relation.Nullary.html" class="Module">Relation.Nullary</a>

<a id="543" class="Keyword">open</a> <a id="548" class="Keyword">import</a> <a id="555" href="Interface.Decidable.Instance.html" class="Module">Interface.Decidable.Instance</a>

<a id="585" class="Keyword">open</a> <a id="590" class="Keyword">import</a> <a id="597" href="Interface.ComputationalRelation.html" class="Module">Interface.ComputationalRelation</a>
<a id="629" class="Keyword">open</a> <a id="634" class="Keyword">import</a> <a id="641" href="Tactic.DeriveComp.html" class="Module">Tactic.DeriveComp</a>
<a id="659" class="Keyword">open</a> <a id="664" class="Keyword">import</a> <a id="671" href="MyDebugOptions.html" class="Module">MyDebugOptions</a>

<a id="687" class="Keyword">instance</a>
  <a id="698" href="MidnightExample.Ledger.html#698" class="Function">_</a> <a id="700" class="Symbol">=</a> <a id="702" href="Data.Integer.Properties.html#31484" class="Function">+-0-commutativeMonoid</a>

  <a id="Hashable-ℕ"></a><a id="727" href="MidnightExample.Ledger.html#727" class="Function">Hashable-ℕ</a> <a id="738" class="Symbol">:</a> <a id="740" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="749" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="751" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a>
  <a id="758" href="MidnightExample.Ledger.html#727" class="Function">Hashable-ℕ</a> <a id="769" class="Symbol">.</a><a id="770" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="775" href="MidnightExample.Ledger.html#775" class="Bound">n</a> <a id="777" class="Symbol">=</a> <a id="779" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="784" class="Symbol">(</a><a id="785" href="Agda.Builtin.Int.html#246" class="InductiveConstructor Operator">+</a> <a id="787" href="MidnightExample.Ledger.html#775" class="Bound">n</a><a id="788" class="Symbol">)</a>

<a id="_&lt;ᵇ_"></a><a id="791" href="MidnightExample.Ledger.html#791" class="Function Operator">_&lt;ᵇ_</a> <a id="796" class="Symbol">:</a> <a id="798" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="804" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="806" class="Symbol">→</a> <a id="808" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="814" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="816" class="Symbol">→</a> <a id="818" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="823" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="828" href="MidnightExample.Ledger.html#828" class="Bound">a</a>  <a id="831" href="MidnightExample.Ledger.html#791" class="Function Operator">&lt;ᵇ</a> <a id="834" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="839" href="MidnightExample.Ledger.html#839" class="Bound">b</a>  <a id="842" class="Symbol">=</a> <a id="844" href="MidnightExample.Ledger.html#828" class="Bound">a</a> <a id="846" href="Data.Nat.Base.html#1301" class="Primitive Operator">Prelude.&lt;ᵇ</a> <a id="857" href="MidnightExample.Ledger.html#839" class="Bound">b</a>
<a id="859" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="864" href="MidnightExample.Ledger.html#864" class="Bound">a</a>  <a id="867" href="MidnightExample.Ledger.html#791" class="Function Operator">&lt;ᵇ</a> <a id="870" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="878" class="Symbol">=</a> <a id="880" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="886" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="894" href="MidnightExample.Ledger.html#791" class="Function Operator">&lt;ᵇ</a> <a id="897" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="902" href="MidnightExample.Ledger.html#902" class="Bound">b</a>  <a id="905" class="Symbol">=</a> <a id="907" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="912" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="920" href="MidnightExample.Ledger.html#791" class="Function Operator">&lt;ᵇ</a> <a id="923" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="931" class="Symbol">=</a> <a id="933" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="939" class="Markup">\end{code}</a><a id="949" class="Background">

This is a small example of a ledger specification for Midnight. It
only assumes that we know how to hash some types and provides a step
function for the ledger together with a proof of a non-trivial
property.

\section{Epochs \&amp; Consensus}

We define the number of slots in an epoch and a conversion function
from slots to epochs here, as well as a structure to refer to certain
points in the chain.

\begin{figure*}[h]
\AgdaTarget{Point, slot, blockHash, slotsInEpoch, epochOf}
</a><a id="1430" class="Markup">\begin{code}</a>
<a id="1443" class="Keyword">record</a> <a id="Point"></a><a id="1450" href="MidnightExample.Ledger.html#1450" class="Record">Point</a> <a id="1456" class="Symbol">:</a> <a id="1458" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1462" class="Keyword">where</a>
  <a id="1470" class="Keyword">field</a>  <a id="Point.slot"></a><a id="1477" href="MidnightExample.Ledger.html#1477" class="Field">slot</a>       <a id="1488" class="Symbol">:</a> <a id="1490" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1496" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
         <a id="Point.blockHash"></a><a id="1507" href="MidnightExample.Ledger.html#1507" class="Field">blockHash</a>  <a id="1518" class="Symbol">:</a> <a id="1520" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a>

<a id="slotsInEpoch"></a><a id="1526" href="MidnightExample.Ledger.html#1526" class="Function">slotsInEpoch</a> <a id="1539" class="Symbol">:</a> <a id="1541" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
<a id="1543" href="MidnightExample.Ledger.html#1526" class="Function">slotsInEpoch</a> <a id="1556" class="Symbol">=</a> <a id="1558" class="Number">50</a>

<a id="epochOf"></a><a id="1562" href="MidnightExample.Ledger.html#1562" class="Function">epochOf</a> <a id="1570" class="Symbol">:</a> <a id="1572" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1578" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="1580" class="Symbol">→</a> <a id="1582" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1588" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
<a id="1590" href="MidnightExample.Ledger.html#1562" class="Function">epochOf</a> <a id="1598" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>  <a id="1607" class="Symbol">=</a> <a id="1609" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="1617" href="MidnightExample.Ledger.html#1562" class="Function">epochOf</a> <a id="1625" class="Symbol">(</a><a id="1626" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="1631" href="MidnightExample.Ledger.html#1631" class="Bound">s</a><a id="1632" class="Symbol">)</a> <a id="1634" class="Symbol">=</a> <a id="1636" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="1641" class="Symbol">(</a><a id="1642" href="MidnightExample.Ledger.html#1631" class="Bound">s</a> <a id="1644" href="Data.Nat.Base.html#5077" class="Function Operator">/</a> <a id="1646" href="MidnightExample.Ledger.html#1526" class="Function">slotsInEpoch</a><a id="1658" class="Symbol">)</a>
<a id="1660" class="Markup">\end{code}</a><a id="1670" class="Background">
\caption{Point- and epoch-related definitions}
\end{figure*}

\newpage

\section{Transactions \&amp; Blocks}

Transactions can increment or decrement a counter that is stored in
the ledger, and blocks consist of a list of transactions and a header,
which contains some meta-information about the block. We also use the
accessor functions of the headers transitively, to access fields in
the header given the body.

\begin{figure*}[h]
\AgdaTarget{Tx, inc, dec, txDelta}
</a><a id="2136" class="Markup">\begin{code}</a>
<a id="2149" class="Keyword">data</a> <a id="Tx"></a><a id="2154" href="MidnightExample.Ledger.html#2154" class="Datatype">Tx</a> <a id="2157" class="Symbol">:</a> <a id="2159" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2163" class="Keyword">where</a>
  <a id="Tx.inc"></a><a id="2171" href="MidnightExample.Ledger.html#2171" class="InductiveConstructor">inc</a>  <a id="2176" class="Symbol">:</a> <a id="2178" href="MidnightExample.Ledger.html#2154" class="Datatype">Tx</a>
  <a id="Tx.dec"></a><a id="2183" href="MidnightExample.Ledger.html#2183" class="InductiveConstructor">dec</a>  <a id="2188" class="Symbol">:</a> <a id="2190" href="MidnightExample.Ledger.html#2154" class="Datatype">Tx</a>

<a id="txDelta"></a><a id="2194" href="MidnightExample.Ledger.html#2194" class="Function">txDelta</a> <a id="2202" class="Symbol">:</a> <a id="2204" href="MidnightExample.Ledger.html#2154" class="Datatype">Tx</a> <a id="2207" class="Symbol">→</a> <a id="2209" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a>
<a id="2211" href="MidnightExample.Ledger.html#2194" class="Function">txDelta</a> <a id="2219" href="MidnightExample.Ledger.html#2171" class="InductiveConstructor">inc</a>  <a id="2224" class="Symbol">=</a> <a id="2226" href="Data.Integer.Base.html#1558" class="Function">1ℤ</a>
<a id="2229" href="MidnightExample.Ledger.html#2194" class="Function">txDelta</a> <a id="2237" href="MidnightExample.Ledger.html#2183" class="InductiveConstructor">dec</a>  <a id="2242" class="Symbol">=</a> <a id="2244" href="Data.Integer.Base.html#1534" class="Function">-1ℤ</a>
<a id="2248" class="Markup">\end{code}</a><a id="2258" class="Background">
</a><a id="2259" class="Markup">\begin{code}[hide]</a>
<a id="2278" class="Keyword">instance</a>
  <a id="Hashable-Tx"></a><a id="2289" href="MidnightExample.Ledger.html#2289" class="Function">Hashable-Tx</a> <a id="2301" class="Symbol">:</a> <a id="2303" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="2312" href="MidnightExample.Ledger.html#2154" class="Datatype">Tx</a> <a id="2315" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a>
  <a id="2322" href="MidnightExample.Ledger.html#2289" class="Function">Hashable-Tx</a> <a id="2334" class="Symbol">.</a><a id="2335" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="2340" class="Symbol">=</a> <a id="2342" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="2347" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="2349" href="MidnightExample.Ledger.html#2194" class="Function">txDelta</a>
<a id="2357" class="Markup">\end{code}</a><a id="2367" class="Background">
\caption{Transactions}
\end{figure*}
\begin{figure*}[h]
\AgdaTarget{Header, slotNo, blockNo, blockHash, prev, nodeId, Block, header, body, blockPoint, computeBlockHash, addBlockHash}
</a><a id="2551" class="Markup">\begin{code}</a>
<a id="2564" class="Keyword">record</a> <a id="Header"></a><a id="2571" href="MidnightExample.Ledger.html#2571" class="Record">Header</a> <a id="2578" class="Symbol">:</a> <a id="2580" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2584" class="Keyword">where</a>
  <a id="2592" class="Keyword">field</a>  <a id="Header.slotNo"></a><a id="2599" href="MidnightExample.Ledger.html#2599" class="Field">slotNo</a>     <a id="2610" class="Symbol">:</a> <a id="2612" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
         <a id="Header.blockNo"></a><a id="2623" href="MidnightExample.Ledger.html#2623" class="Field">blockNo</a>    <a id="2634" class="Symbol">:</a> <a id="2636" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
         <a id="Header.blockHash"></a><a id="2647" href="MidnightExample.Ledger.html#2647" class="Field">blockHash</a>  <a id="2658" class="Symbol">:</a> <a id="2660" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a>
         <a id="Header.prev"></a><a id="2674" href="MidnightExample.Ledger.html#2674" class="Field">prev</a>       <a id="2685" class="Symbol">:</a> <a id="2687" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
         <a id="Header.nodeId"></a><a id="2698" href="MidnightExample.Ledger.html#2698" class="Field">nodeId</a>     <a id="2709" class="Symbol">:</a> <a id="2711" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>

<a id="2714" class="Keyword">record</a> <a id="Block"></a><a id="2721" href="MidnightExample.Ledger.html#2721" class="Record">Block</a> <a id="2727" class="Symbol">:</a> <a id="2729" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2733" class="Keyword">where</a>
  <a id="2741" class="Keyword">field</a>  <a id="Block.header"></a><a id="2748" href="MidnightExample.Ledger.html#2748" class="Field">header</a>  <a id="2756" class="Symbol">:</a> <a id="2758" href="MidnightExample.Ledger.html#2571" class="Record">Header</a>
         <a id="Block.body"></a><a id="2774" href="MidnightExample.Ledger.html#2774" class="Field">body</a>    <a id="2782" class="Symbol">:</a> <a id="2784" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2789" href="MidnightExample.Ledger.html#2154" class="Datatype">Tx</a>

  <a id="2795" class="Keyword">open</a> <a id="2800" href="MidnightExample.Ledger.html#2571" class="Module">Header</a> <a id="2807" href="MidnightExample.Ledger.html#2748" class="Field">header</a> <a id="2814" class="Keyword">public</a>

<a id="blockPoint"></a><a id="2822" href="MidnightExample.Ledger.html#2822" class="Function">blockPoint</a> <a id="2833" class="Symbol">:</a> <a id="2835" href="MidnightExample.Ledger.html#2721" class="Record">Block</a> <a id="2841" class="Symbol">→</a> <a id="2843" href="MidnightExample.Ledger.html#1450" class="Record">Point</a>
<a id="2849" href="MidnightExample.Ledger.html#2822" class="Function">blockPoint</a> <a id="2860" href="MidnightExample.Ledger.html#2860" class="Bound">b</a> <a id="2862" class="Symbol">=</a> <a id="2864" class="Keyword">record</a> <a id="2871" class="Symbol">{</a> <a id="2873" href="MidnightExample.Ledger.html#1477" class="Field">slot</a> <a id="2878" class="Symbol">=</a> <a id="2880" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2885" href="MidnightExample.Ledger.html#2599" class="Function">slotNo</a> <a id="2892" class="Symbol">;</a> <a id="2894" href="MidnightExample.Ledger.html#1507" class="Field">blockHash</a> <a id="2904" class="Symbol">=</a> <a id="2906" href="MidnightExample.Ledger.html#2647" class="Function">blockHash</a> <a id="2916" class="Symbol">}</a>
  <a id="2920" class="Keyword">where</a> <a id="2926" class="Keyword">open</a> <a id="2931" href="MidnightExample.Ledger.html#2721" class="Module">Block</a> <a id="2937" href="MidnightExample.Ledger.html#2860" class="Bound">b</a>

<a id="computeBlockHash"></a><a id="2940" href="MidnightExample.Ledger.html#2940" class="Function">computeBlockHash</a> <a id="2957" class="Symbol">:</a> <a id="2959" href="MidnightExample.Ledger.html#2721" class="Record">Block</a> <a id="2965" class="Symbol">→</a> <a id="2967" href="MidnightExample.Ledger.html#310" class="Bound">Hash</a>
<a id="2972" href="MidnightExample.Ledger.html#2940" class="Function">computeBlockHash</a> <a id="2989" href="MidnightExample.Ledger.html#2989" class="Bound">b</a> <a id="2991" class="Symbol">=</a> <a id="2993" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="2998" class="Symbol">(</a><a id="2999" href="MidnightExample.Ledger.html#2599" class="Function">slotNo</a> <a id="3006" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3008" href="MidnightExample.Ledger.html#2623" class="Function">blockNo</a> <a id="3016" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3018" href="MidnightExample.Ledger.html#2674" class="Function">prev</a> <a id="3023" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3025" href="MidnightExample.Ledger.html#2774" class="Field">body</a><a id="3029" class="Symbol">)</a>
  <a id="3033" class="Keyword">where</a> <a id="3039" class="Keyword">open</a> <a id="3044" href="MidnightExample.Ledger.html#2721" class="Module">Block</a> <a id="3050" href="MidnightExample.Ledger.html#2989" class="Bound">b</a>

<a id="addBlockHash"></a><a id="3053" href="MidnightExample.Ledger.html#3053" class="Function">addBlockHash</a> <a id="3066" class="Symbol">:</a> <a id="3068" href="MidnightExample.Ledger.html#2721" class="Record">Block</a> <a id="3074" class="Symbol">→</a> <a id="3076" href="MidnightExample.Ledger.html#2721" class="Record">Block</a>
<a id="3082" href="MidnightExample.Ledger.html#3053" class="Function">addBlockHash</a> <a id="3095" href="MidnightExample.Ledger.html#3095" class="Bound">b</a> <a id="3097" class="Symbol">=</a> <a id="3099" class="Keyword">record</a> <a id="3106" href="MidnightExample.Ledger.html#3095" class="Bound">b</a> <a id="3108" class="Symbol">{</a> <a id="3110" href="MidnightExample.Ledger.html#2748" class="Field">header</a> <a id="3117" class="Symbol">=</a> <a id="3119" class="Keyword">record</a> <a id="3126" href="MidnightExample.Ledger.html#2748" class="Field">header</a> <a id="3133" class="Symbol">{</a> <a id="3135" href="MidnightExample.Ledger.html#2647" class="Field">blockHash</a> <a id="3145" class="Symbol">=</a> <a id="3147" href="MidnightExample.Ledger.html#2940" class="Function">computeBlockHash</a> <a id="3164" href="MidnightExample.Ledger.html#3095" class="Bound">b</a> <a id="3166" class="Symbol">}</a> <a id="3168" class="Symbol">}</a>
  <a id="3172" class="Keyword">where</a> <a id="3178" class="Keyword">open</a> <a id="3183" href="MidnightExample.Ledger.html#2721" class="Module">Block</a> <a id="3189" href="MidnightExample.Ledger.html#3095" class="Bound">b</a>
<a id="3191" class="Markup">\end{code}</a><a id="3201" class="Background">
\caption{Blocks and functions related to them}
\end{figure*}

\newpage

\section{Ledger}

The ledger state consists of a pointer to the previous block as well as a counter and two snapshots. Ticking a ledger state means to roll over the snapshots.
\begin{figure*}[h]
\AgdaTarget{LedgerState, tip, count, snapshot1, snapshot2, tickLedgerState}
\begin{AgdaSuppressSpace}
</a><a id="3571" class="Markup">\begin{code}</a>
<a id="3584" class="Keyword">record</a> <a id="LedgerState"></a><a id="3591" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a> <a id="3603" class="Symbol">:</a> <a id="3605" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3609" class="Keyword">where</a>
  <a id="3617" class="Keyword">field</a>  <a id="LedgerState.tip"></a><a id="3624" href="MidnightExample.Ledger.html#3624" class="Field">tip</a>                  <a id="3645" class="Symbol">:</a> <a id="3647" href="MidnightExample.Ledger.html#1450" class="Record">Point</a>
         <a id="LedgerState.count"></a><a id="3662" href="MidnightExample.Ledger.html#3662" class="Field">count</a>                <a id="3683" class="Symbol">:</a> <a id="3685" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a>
         <a id="LedgerState.snapshot1"></a><a id="3696" href="MidnightExample.Ledger.html#3696" class="Field">snapshot1</a> <a id="LedgerState.snapshot2"></a><a id="3706" href="MidnightExample.Ledger.html#3706" class="Field">snapshot2</a>  <a id="3717" class="Symbol">:</a> <a id="3719" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a>

<a id="3722" class="Markup">\end{code}</a><a id="3732" class="Background">
</a><a id="3733" class="Markup">\begin{code}[hide]</a>
<a id="3752" class="Keyword">open</a> <a id="3757" href="MidnightExample.Ledger.html#3591" class="Module">LedgerState</a>
<a id="3769" class="Markup">\end{code}</a><a id="3779" class="Background">
</a><a id="3780" class="Markup">\begin{code}</a>
<a id="tickLedgerState"></a><a id="3793" href="MidnightExample.Ledger.html#3793" class="Function">tickLedgerState</a> <a id="3809" class="Symbol">:</a> <a id="3811" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="3813" class="Symbol">→</a> <a id="3815" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a> <a id="3827" class="Symbol">→</a> <a id="3829" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a>
<a id="3841" href="MidnightExample.Ledger.html#3793" class="Function">tickLedgerState</a> <a id="3857" href="MidnightExample.Ledger.html#3857" class="Bound">newSlot</a> <a id="3865" href="MidnightExample.Ledger.html#3865" class="Bound">st</a> <a id="3868" class="Symbol">=</a> <a id="3870" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="3873" href="MidnightExample.Ledger.html#3971" class="Function">isNewEpoch</a>
  <a id="3886" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="3891" class="Keyword">record</a> <a id="3898" href="MidnightExample.Ledger.html#3865" class="Bound">st</a> <a id="3901" class="Symbol">{</a> <a id="3903" href="MidnightExample.Ledger.html#3696" class="Field">snapshot1</a> <a id="3913" class="Symbol">=</a> <a id="3915" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="3921" href="MidnightExample.Ledger.html#3865" class="Bound">st</a> <a id="3924" class="Symbol">;</a> <a id="3926" href="MidnightExample.Ledger.html#3706" class="Field">snapshot2</a> <a id="3936" class="Symbol">=</a> <a id="3938" href="MidnightExample.Ledger.html#3696" class="Field">snapshot1</a> <a id="3948" href="MidnightExample.Ledger.html#3865" class="Bound">st</a> <a id="3951" class="Symbol">}</a>
  <a id="3955" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="3960" href="MidnightExample.Ledger.html#3865" class="Bound">st</a>
  <a id="3965" class="Keyword">where</a> <a id="3971" href="MidnightExample.Ledger.html#3971" class="Function">isNewEpoch</a> <a id="3982" class="Symbol">=</a> <a id="3984" href="MidnightExample.Ledger.html#1562" class="Function">epochOf</a> <a id="3992" class="Symbol">(</a><a id="3993" href="MidnightExample.Ledger.html#1477" class="Field">Point.slot</a> <a id="4004" class="Symbol">(</a><a id="4005" href="MidnightExample.Ledger.html#3624" class="Field">tip</a> <a id="4009" href="MidnightExample.Ledger.html#3865" class="Bound">st</a><a id="4011" class="Symbol">))</a> <a id="4014" href="MidnightExample.Ledger.html#791" class="Function Operator">&lt;ᵇ</a> <a id="4017" href="MidnightExample.Ledger.html#1562" class="Function">epochOf</a> <a id="4025" class="Symbol">(</a><a id="4026" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4031" href="MidnightExample.Ledger.html#3857" class="Bound">newSlot</a><a id="4038" class="Symbol">)</a>
<a id="4040" class="Markup">\end{code}</a><a id="4050" class="Background">
\end{AgdaSuppressSpace}
\caption{Ledger state and its tick function}
\end{figure*}

The ledger transition system updates the tip to point to the most
recent applied block, and increments/decrements the counter according
to the transactions. We also want to check some non-trivial
conditions, so we require the change to the counter to be non-zero and
that the hash in the header is correct.

\begin{figure*}[h]
\AgdaTarget{\_⊢\_⇀⦇\_,LEDGER⦈\_, LEDGER-inductive}
</a><a id="4513" class="Markup">\begin{code}</a>
<a id="4526" class="Keyword">data</a> <a id="_⊢_⇀⦇_,LEDGER⦈_"></a><a id="4531" href="MidnightExample.Ledger.html#4531" class="Datatype Operator">_⊢_⇀⦇_,LEDGER⦈_</a> <a id="4547" class="Symbol">:</a> <a id="4549" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a> <a id="4551" class="Symbol">→</a> <a id="4553" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a> <a id="4565" class="Symbol">→</a> <a id="4567" href="MidnightExample.Ledger.html#2721" class="Record">Block</a> <a id="4573" class="Symbol">→</a> <a id="4575" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a> <a id="4587" class="Symbol">→</a> <a id="4589" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4593" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,LEDGER⦈_.LEDGER-inductive"></a><a id="4601" href="MidnightExample.Ledger.html#4601" class="InductiveConstructor">LEDGER-inductive</a> <a id="4618" class="Symbol">:</a> <a id="4620" class="Symbol">∀</a> <a id="4622" class="Symbol">{</a><a id="4623" href="MidnightExample.Ledger.html#4623" class="Bound">Γ</a><a id="4624" class="Symbol">}</a> <a id="4626" class="Symbol">{</a><a id="4627" href="MidnightExample.Ledger.html#4627" class="Bound">s</a><a id="4628" class="Symbol">}</a> <a id="4630" class="Symbol">{</a><a id="4631" href="MidnightExample.Ledger.html#4631" class="Bound">b</a><a id="4632" class="Symbol">}</a> <a id="4634" class="Symbol">→</a>
    <a id="4640" class="Keyword">let</a> <a id="4644" class="Keyword">open</a> <a id="4649" href="MidnightExample.Ledger.html#2721" class="Module">Block</a> <a id="4655" href="MidnightExample.Ledger.html#4631" class="Bound">b</a>
        <a id="4665" href="MidnightExample.Ledger.html#4665" class="Bound">acc</a> <a id="4669" class="Symbol">=</a> <a id="4671" href="Axiom.Set.Sum.html#1617" class="Function">Σˡ[</a> <a id="4675" href="MidnightExample.Ledger.html#4675" class="Bound">x</a> <a id="4677" href="Axiom.Set.Sum.html#1617" class="Function">←</a> <a id="4679" href="MidnightExample.Ledger.html#2774" class="Field">body</a> <a id="4684" href="Axiom.Set.Sum.html#1617" class="Function">]</a> <a id="4686" href="MidnightExample.Ledger.html#2194" class="Function">txDelta</a> <a id="4694" href="MidnightExample.Ledger.html#4675" class="Bound">x</a>
        <a id="4704" href="MidnightExample.Ledger.html#4704" class="Bound">s&#39;</a>  <a id="4708" class="Symbol">=</a> <a id="4710" href="MidnightExample.Ledger.html#3793" class="Function">tickLedgerState</a> <a id="4726" href="MidnightExample.Ledger.html#2599" class="Function">slotNo</a> <a id="4733" href="MidnightExample.Ledger.html#4627" class="Bound">s</a>
    <a id="4739" class="Keyword">in</a> <a id="4742" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="4744" href="MidnightExample.Ledger.html#4665" class="Bound">acc</a> <a id="4748" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="4750" href="Data.Integer.Base.html#1518" class="Function">0ℤ</a>        <a id="4760" href="Interface.STS.html#129" class="Function Operator">∙</a> <a id="4762" href="MidnightExample.Ledger.html#2940" class="Function">computeBlockHash</a> <a id="4779" href="MidnightExample.Ledger.html#4631" class="Bound">b</a> <a id="4781" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4783" href="MidnightExample.Ledger.html#2647" class="Function">blockHash</a>
    <a id="4797" href="Interface.STS.html#211" class="Function Operator">────────────────────────────────</a>
    <a id="4834" href="MidnightExample.Ledger.html#4623" class="Bound">Γ</a> <a id="4836" href="MidnightExample.Ledger.html#4531" class="Datatype Operator">⊢</a> <a id="4838" href="MidnightExample.Ledger.html#4627" class="Bound">s</a> <a id="4840" href="MidnightExample.Ledger.html#4531" class="Datatype Operator">⇀⦇</a> <a id="4843" href="MidnightExample.Ledger.html#4631" class="Bound">b</a> <a id="4845" href="MidnightExample.Ledger.html#4531" class="Datatype Operator">,LEDGER⦈</a>
      <a id="4860" class="Keyword">record</a> <a id="4867" href="MidnightExample.Ledger.html#4704" class="Bound">s&#39;</a> <a id="4870" class="Symbol">{</a> <a id="4872" href="MidnightExample.Ledger.html#3624" class="Field">tip</a> <a id="4876" class="Symbol">=</a> <a id="4878" href="MidnightExample.Ledger.html#2822" class="Function">blockPoint</a> <a id="4889" href="MidnightExample.Ledger.html#4631" class="Bound">b</a> <a id="4891" class="Symbol">;</a> <a id="4893" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="4899" class="Symbol">=</a> <a id="4901" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="4907" href="MidnightExample.Ledger.html#4627" class="Bound">s</a> <a id="4909" href="Data.Integer.Base.html#5004" class="Function Operator">+</a> <a id="4911" href="MidnightExample.Ledger.html#4665" class="Bound">acc</a> <a id="4915" class="Symbol">}</a>
<a id="4917" class="Markup">\end{code}</a><a id="4927" class="Background">
\caption{The LEDGER transition system}
\end{figure*}

We also have automation that generates a step function for this
relation. As an example, we also provide a function that does the same
computation explicitly.

</a><a id="5142" class="Markup">\begin{code}[hide]</a>
<a id="5161" class="Keyword">unquoteDecl</a> <a id="Computational-LEDGER"></a><a id="5173" href="MidnightExample.Ledger.html#5173" class="Function">Computational-LEDGER</a> <a id="5194" class="Symbol">=</a> <a id="5196" href="Tactic.DeriveComp.html#7204" class="Function">deriveComputational</a> <a id="5216" class="Symbol">(</a><a id="5217" class="Keyword">quote</a> <a id="5223" href="MidnightExample.Ledger.html#4531" class="Datatype Operator">_⊢_⇀⦇_,LEDGER⦈_</a><a id="5238" class="Symbol">)</a> <a id="5240" href="MidnightExample.Ledger.html#5173" class="Function">Computational-LEDGER</a>
<a id="5261" class="Keyword">open</a> <a id="5266" href="Interface.ComputationalRelation.html#368" class="Module">Computational</a> <a id="5280" href="MidnightExample.Ledger.html#5173" class="Function">Computational-LEDGER</a>
<a id="5301" class="Markup">\end{code}</a><a id="5311" class="Background">
\begin{figure*}[h]
</a><a id="5331" class="Markup">\begin{code}</a>
<a id="LEDGER-step"></a><a id="5344" href="MidnightExample.Ledger.html#5344" class="Function">LEDGER-step</a> <a id="5356" class="Symbol">:</a> <a id="5358" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a> <a id="5360" class="Symbol">→</a> <a id="5362" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a> <a id="5374" class="Symbol">→</a> <a id="5376" href="MidnightExample.Ledger.html#2721" class="Record">Block</a> <a id="5382" class="Symbol">→</a> <a id="5384" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5390" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a>
<a id="5402" href="MidnightExample.Ledger.html#5344" class="Function">LEDGER-step</a> <a id="5414" class="Symbol">=</a> <a id="5416" href="Interface.ComputationalRelation.html#442" class="Function">compute</a>

<a id="applyBlockTo"></a><a id="5425" href="MidnightExample.Ledger.html#5425" class="Function">applyBlockTo</a> <a id="5438" class="Symbol">:</a> <a id="5440" href="MidnightExample.Ledger.html#2721" class="Record">Block</a> <a id="5446" class="Symbol">→</a> <a id="5448" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a> <a id="5460" class="Symbol">→</a> <a id="5462" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5468" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a>
<a id="5480" href="MidnightExample.Ledger.html#5425" class="Function">applyBlockTo</a> <a id="5493" href="MidnightExample.Ledger.html#5493" class="Bound">b</a> <a id="5495" href="MidnightExample.Ledger.html#5495" class="Bound">st</a> <a id="5498" class="Symbol">=</a> <a id="5500" class="Keyword">let</a> <a id="5504" href="MidnightExample.Ledger.html#5504" class="Bound">acc</a> <a id="5508" class="Symbol">=</a> <a id="5510" href="Axiom.Set.Sum.html#1617" class="Function">Σˡ[</a> <a id="5514" href="MidnightExample.Ledger.html#5514" class="Bound">x</a> <a id="5516" href="Axiom.Set.Sum.html#1617" class="Function">←</a> <a id="5518" href="MidnightExample.Ledger.html#2774" class="Field">Block.body</a> <a id="5529" href="MidnightExample.Ledger.html#5493" class="Bound">b</a> <a id="5531" href="Axiom.Set.Sum.html#1617" class="Function">]</a> <a id="5533" href="MidnightExample.Ledger.html#2194" class="Function">txDelta</a> <a id="5541" href="MidnightExample.Ledger.html#5514" class="Bound">x</a> <a id="5543" class="Keyword">in</a>
  <a id="5548" href="Interface.Decidable.Instance.html#663" class="Function Operator">ifᵈ</a> <a id="5552" href="MidnightExample.Ledger.html#5504" class="Bound">acc</a> <a id="5556" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="5558" href="Data.Integer.Base.html#1518" class="Function">0ℤ</a> <a id="5561" href="MidnightExample.Ledger.html#183" class="Function Operator">∧</a> <a id="5563" href="MidnightExample.Ledger.html#2940" class="Function">computeBlockHash</a> <a id="5580" href="MidnightExample.Ledger.html#5493" class="Bound">b</a> <a id="5582" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5584" href="MidnightExample.Ledger.html#2647" class="Function">Block.blockHash</a> <a id="5600" href="MidnightExample.Ledger.html#5493" class="Bound">b</a>
    <a id="5606" href="Interface.Decidable.Instance.html#663" class="Function Operator">then</a> <a id="5611" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5616" class="Keyword">record</a> <a id="5623" href="MidnightExample.Ledger.html#5495" class="Bound">st</a> <a id="5626" class="Symbol">{</a> <a id="5628" href="MidnightExample.Ledger.html#3624" class="Field">tip</a> <a id="5632" class="Symbol">=</a> <a id="5634" href="MidnightExample.Ledger.html#2822" class="Function">blockPoint</a> <a id="5645" href="MidnightExample.Ledger.html#5493" class="Bound">b</a> <a id="5647" class="Symbol">;</a> <a id="5649" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="5655" class="Symbol">=</a> <a id="5657" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="5663" href="MidnightExample.Ledger.html#5495" class="Bound">st</a> <a id="5666" href="Data.Integer.Base.html#5004" class="Function Operator">+</a> <a id="5668" href="MidnightExample.Ledger.html#5504" class="Bound">acc</a> <a id="5672" class="Symbol">}</a>
    <a id="5678" href="Interface.Decidable.Instance.html#663" class="Function Operator">else</a> <a id="5683" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="5691" class="Markup">\end{code}</a><a id="5701" class="Background">
\end{figure*}

\newpage

\section{Key properties}

This is Agda, so we can prove some properties. Since we check very few
things, and just repeating properties that we do check isn&#39;t
interesting, here&#39;s the only non-trivial property that I could think
of: That the counter in the ledger state does change.

We present three proofs here, one using the STS, one using the step
function generated from the STS, and one using the
\AgdaFunction{applyBlockTo} function to show why using the STS is more
convenient for proofs: Instead of tracing the function control flow to
extract properties, we can simply pattern-match for them. After we
obtained fact that the sum of changes induced by transactions is
non-zero, the proofs are identical.

</a><a id="6439" class="Markup">\begin{code}[hide]</a>
<a id="6458" class="Keyword">private</a> <a id="6466" class="Keyword">variable</a> <a id="6475" href="MidnightExample.Ledger.html#6475" class="Generalizable">s</a> <a id="6477" href="MidnightExample.Ledger.html#6477" class="Generalizable">s&#39;</a> <a id="6480" class="Symbol">:</a> <a id="6482" href="MidnightExample.Ledger.html#3591" class="Record">LedgerState</a>
                 <a id="6511" href="MidnightExample.Ledger.html#6511" class="Generalizable">b</a> <a id="6513" class="Symbol">:</a> <a id="6515" href="MidnightExample.Ledger.html#2721" class="Record">Block</a>

<a id="6522" class="Keyword">open</a> <a id="6527" class="Keyword">import</a> <a id="6534" href="Algebra.Properties.AbelianGroup.html" class="Module">Algebra.Properties.AbelianGroup</a> <a id="6566" href="Data.Integer.Properties.html#31618" class="Function">+-0-abelianGroup</a>
<a id="6583" class="Markup">\end{code}</a><a id="6593" class="Background">
\begin{figure*}[h]
</a><a id="6613" class="Markup">\begin{code}</a>
<a id="lemma"></a><a id="6626" href="MidnightExample.Ledger.html#6626" class="Function">lemma</a> <a id="6632" class="Symbol">:</a> <a id="6634" class="Symbol">∀</a> <a id="6636" class="Symbol">{</a><a id="6637" href="MidnightExample.Ledger.html#6637" class="Bound">x</a> <a id="6639" href="MidnightExample.Ledger.html#6639" class="Bound">y</a><a id="6640" class="Symbol">}</a> <a id="6642" class="Symbol">→</a> <a id="6644" href="MidnightExample.Ledger.html#6639" class="Bound">y</a> <a id="6646" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="6648" href="Data.Integer.Base.html#1518" class="Function">0ℤ</a> <a id="6651" class="Symbol">→</a> <a id="6653" href="MidnightExample.Ledger.html#6637" class="Bound">x</a> <a id="6655" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="6657" href="MidnightExample.Ledger.html#6637" class="Bound">x</a> <a id="6659" href="Data.Integer.Base.html#5004" class="Function Operator">+</a> <a id="6661" href="MidnightExample.Ledger.html#6639" class="Bound">y</a>
<a id="6663" href="MidnightExample.Ledger.html#6626" class="Function">lemma</a> <a id="6669" href="MidnightExample.Ledger.html#6669" class="Bound">y≢0</a> <a id="6673" href="MidnightExample.Ledger.html#6673" class="Bound">eq</a> <a id="6676" class="Symbol">=</a> <a id="6678" href="MidnightExample.Ledger.html#6669" class="Bound">y≢0</a> <a id="6682" class="Symbol">(</a><a id="6683" href="Algebra.Properties.Group.html#2443" class="Function">identityʳ-unique</a> <a id="6700" class="Symbol">_</a> <a id="6702" class="Symbol">_</a> <a id="6704" class="Symbol">(</a><a id="6705" href="Relation.Binary.PropositionalEquality.Core.html#1698" class="Function">sym</a> <a id="6709" href="MidnightExample.Ledger.html#6673" class="Bound">eq</a><a id="6711" class="Symbol">))</a>

<a id="LEDGER-property₁"></a><a id="6715" href="MidnightExample.Ledger.html#6715" class="Function">LEDGER-property₁</a> <a id="6732" class="Symbol">:</a> <a id="6734" class="Symbol">_</a> <a id="6736" href="MidnightExample.Ledger.html#4531" class="Datatype Operator">⊢</a> <a id="6738" href="MidnightExample.Ledger.html#6475" class="Generalizable">s</a> <a id="6740" href="MidnightExample.Ledger.html#4531" class="Datatype Operator">⇀⦇</a> <a id="6743" href="MidnightExample.Ledger.html#6511" class="Generalizable">b</a> <a id="6745" href="MidnightExample.Ledger.html#4531" class="Datatype Operator">,LEDGER⦈</a> <a id="6754" href="MidnightExample.Ledger.html#6477" class="Generalizable">s&#39;</a> <a id="6757" class="Symbol">→</a> <a id="6759" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="6765" href="MidnightExample.Ledger.html#6475" class="Generalizable">s</a> <a id="6767" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="6769" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="6775" href="MidnightExample.Ledger.html#6477" class="Generalizable">s&#39;</a>
<a id="6778" href="MidnightExample.Ledger.html#6715" class="Function">LEDGER-property₁</a> <a id="6795" class="Symbol">(</a><a id="6796" href="MidnightExample.Ledger.html#4601" class="InductiveConstructor">LEDGER-inductive</a> <a id="6813" href="MidnightExample.Ledger.html#6813" class="Bound">acc≢0</a> <a id="6819" class="Symbol">_)</a> <a id="6822" class="Symbol">=</a> <a id="6824" href="MidnightExample.Ledger.html#6626" class="Function">lemma</a> <a id="6830" href="MidnightExample.Ledger.html#6813" class="Bound">acc≢0</a>

<a id="LEDGER-property₂"></a><a id="6837" href="MidnightExample.Ledger.html#6837" class="Function">LEDGER-property₂</a> <a id="6854" class="Symbol">:</a> <a id="6856" href="MidnightExample.Ledger.html#5344" class="Function">LEDGER-step</a> <a id="6868" class="Symbol">_</a> <a id="6870" href="MidnightExample.Ledger.html#6475" class="Generalizable">s</a> <a id="6872" href="MidnightExample.Ledger.html#6511" class="Generalizable">b</a> <a id="6874" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="6876" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6881" href="MidnightExample.Ledger.html#6477" class="Generalizable">s&#39;</a> <a id="6884" class="Symbol">→</a> <a id="6886" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="6892" href="MidnightExample.Ledger.html#6475" class="Generalizable">s</a> <a id="6894" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="6896" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="6902" href="MidnightExample.Ledger.html#6477" class="Generalizable">s&#39;</a>
<a id="6905" href="MidnightExample.Ledger.html#6837" class="Function">LEDGER-property₂</a> <a id="6922" class="Symbol">{</a><a id="6923" href="MidnightExample.Ledger.html#6923" class="Bound">s</a><a id="6924" class="Symbol">}</a> <a id="6926" class="Symbol">{</a><a id="6927" href="MidnightExample.Ledger.html#6927" class="Bound">b</a><a id="6928" class="Symbol">}</a> <a id="6930" href="MidnightExample.Ledger.html#6930" class="Bound">eq</a> <a id="6933" class="Keyword">with</a> <a id="6938" href="Function.Bundles.html#4398" class="Field">Equivalence.to</a> <a id="6953" class="Symbol">(</a><a id="6954" href="Interface.ComputationalRelation.html#480" class="Function">≡-just⇔STS</a> <a id="6965" class="Symbol">{</a><a id="6966" class="Argument">s</a> <a id="6968" class="Symbol">=</a> <a id="6970" href="MidnightExample.Ledger.html#6923" class="Bound">s</a><a id="6971" class="Symbol">}</a> <a id="6973" class="Symbol">{</a><a id="6974" class="Argument">sig</a> <a id="6978" class="Symbol">=</a> <a id="6980" href="MidnightExample.Ledger.html#6927" class="Bound">b</a><a id="6981" class="Symbol">})</a> <a id="6984" href="MidnightExample.Ledger.html#6930" class="Bound">eq</a>
<a id="6987" class="Symbol">...</a> <a id="6991" class="Symbol">|</a> <a id="6993" class="Symbol">(</a><a id="6994" href="MidnightExample.Ledger.html#4601" class="InductiveConstructor">LEDGER-inductive</a> <a id="7011" href="MidnightExample.Ledger.html#7011" class="Bound">acc≢0</a> <a id="7017" class="Symbol">_)</a> <a id="7020" class="Symbol">=</a> <a id="7022" href="MidnightExample.Ledger.html#6626" class="Function">lemma</a> <a id="7028" href="MidnightExample.Ledger.html#7011" class="Bound">acc≢0</a>

<a id="LEDGER-property₃"></a><a id="7035" href="MidnightExample.Ledger.html#7035" class="Function">LEDGER-property₃</a> <a id="7052" class="Symbol">:</a> <a id="7054" href="MidnightExample.Ledger.html#5425" class="Function">applyBlockTo</a> <a id="7067" href="MidnightExample.Ledger.html#6511" class="Generalizable">b</a> <a id="7069" href="MidnightExample.Ledger.html#6475" class="Generalizable">s</a> <a id="7071" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7073" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="7078" href="MidnightExample.Ledger.html#6477" class="Generalizable">s&#39;</a> <a id="7081" class="Symbol">→</a> <a id="7083" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="7089" href="MidnightExample.Ledger.html#6475" class="Generalizable">s</a> <a id="7091" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="7093" href="MidnightExample.Ledger.html#3662" class="Field">count</a> <a id="7099" href="MidnightExample.Ledger.html#6477" class="Generalizable">s&#39;</a>
<a id="7102" href="MidnightExample.Ledger.html#7035" class="Function">LEDGER-property₃</a> <a id="7119" class="Symbol">{</a><a id="7120" class="Argument">b</a> <a id="7122" class="Symbol">=</a> <a id="7124" href="MidnightExample.Ledger.html#7124" class="Bound">b</a><a id="7125" class="Symbol">}</a> <a id="7127" href="MidnightExample.Ledger.html#7127" class="Bound">h</a> <a id="7129" class="Keyword">with</a>
  <a id="7136" class="Symbol">(</a><a id="7137" href="Axiom.Set.Sum.html#1617" class="Function">Σˡ[</a> <a id="7141" href="MidnightExample.Ledger.html#7141" class="Bound">x</a> <a id="7143" href="Axiom.Set.Sum.html#1617" class="Function">←</a> <a id="7145" href="MidnightExample.Ledger.html#2774" class="Field">Block.body</a> <a id="7156" href="MidnightExample.Ledger.html#7124" class="Bound">b</a> <a id="7158" href="Axiom.Set.Sum.html#1617" class="Function">]</a> <a id="7160" href="MidnightExample.Ledger.html#2194" class="Function">txDelta</a> <a id="7168" href="MidnightExample.Ledger.html#7141" class="Bound">x</a><a id="7169" class="Symbol">)</a> <a id="7171" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="7173" href="Data.Integer.Base.html#1518" class="Function">0ℤ</a> <a id="7176" class="Symbol">|</a> <a id="7178" href="MidnightExample.Ledger.html#2940" class="Function">computeBlockHash</a> <a id="7195" href="MidnightExample.Ledger.html#7124" class="Bound">b</a> <a id="7197" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="7199" href="MidnightExample.Ledger.html#2647" class="Function">Block.blockHash</a> <a id="7215" href="MidnightExample.Ledger.html#7124" class="Bound">b</a> <a id="7217" class="Symbol">|</a> <a id="7219" href="MidnightExample.Ledger.html#7127" class="Bound">h</a>
<a id="7221" class="Symbol">...</a> <a id="7225" class="Symbol">|</a> <a id="7227" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="7230" href="MidnightExample.Ledger.html#7230" class="Bound">acc≢0</a> <a id="7236" class="Symbol">|</a> <a id="7238" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="7242" class="Symbol">_</a> <a id="7244" class="Symbol">|</a> <a id="7246" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="7251" class="Symbol">=</a> <a id="7253" href="MidnightExample.Ledger.html#6626" class="Function">lemma</a> <a id="7259" href="MidnightExample.Ledger.html#7230" class="Bound">acc≢0</a>
<a id="7265" class="Symbol">...</a> <a id="7269" class="Symbol">|</a> <a id="7271" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="7274" class="Symbol">_</a>     <a id="7280" class="Symbol">|</a> <a id="7282" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="7285" class="Symbol">_</a>  <a id="7288" class="Symbol">|</a> <a id="7290" class="Symbol">()</a>
<a id="7293" class="Symbol">...</a> <a id="7297" class="Symbol">|</a> <a id="7299" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="7303" class="Symbol">_</a>    <a id="7308" class="Symbol">|</a> <a id="7310" class="Symbol">_</a>     <a id="7316" class="Symbol">|</a> <a id="7318" class="Symbol">()</a>
<a id="7321" class="Markup">\end{code}</a><a id="7331" class="Background">
\caption{Three proofs that the counter doesn&#39;t stay constant}
\end{figure*}
</a></pre></body></html>