<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Gov</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Governance}

</a><a id="23" class="Markup">\begin{code}[hide]</a>
<a id="42" class="Symbol">{-#</a> <a id="46" class="Keyword">OPTIONS</a> <a id="54" class="Pragma">--safe</a> <a id="61" class="Symbol">#-}</a>
<a id="65" class="Keyword">open</a> <a id="70" class="Keyword">import</a> <a id="77" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>

<a id="92" class="Keyword">open</a> <a id="97" class="Keyword">import</a> <a id="104" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="119" class="Keyword">hiding</a> <a id="126" class="Symbol">(</a><a id="127" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a><a id="130" class="Symbol">;</a> <a id="132" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a><a id="134" class="Symbol">)</a>
<a id="136" class="Keyword">open</a> <a id="141" class="Keyword">import</a> <a id="148" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>

<a id="162" class="Keyword">import</a> <a id="169" href="Ledger.PParams.html" class="Module">Ledger.PParams</a> <a id="184" class="Symbol">as</a> <a id="187" class="Module">PP</a>

<a id="191" class="Keyword">module</a> <a id="198" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="209" class="Symbol">(</a><a id="210" href="Ledger.Gov.html#210" class="Bound">TxId</a> <a id="215" href="Ledger.Gov.html#215" class="Bound">Network</a> <a id="223" href="Ledger.Gov.html#223" class="Bound">DocHash</a> <a id="231" class="Symbol">:</a> <a id="233" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="236" class="Symbol">)</a>
                  <a id="256" class="Symbol">(</a><a id="257" href="Ledger.Gov.html#257" class="Bound">es</a> <a id="260" class="Symbol">:</a> <a id="262" href="Ledger.Epoch.html#526" class="Record">EpochStructure</a><a id="276" class="Symbol">)</a> <a id="278" class="Symbol">(</a><a id="279" class="Keyword">open</a> <a id="284" href="Ledger.Epoch.html#526" class="Module">EpochStructure</a> <a id="299" href="Ledger.Gov.html#257" class="Bound">es</a> <a id="302" class="Keyword">hiding</a> <a id="309" class="Symbol">(</a><a id="310" href="Ledger.Epoch.html#647" class="Field">epoch</a><a id="315" class="Symbol">))</a>
                  <a id="336" class="Symbol">(</a><a id="337" class="Keyword">open</a> <a id="342" href="Ledger.PParams.html" class="Module">PP</a> <a id="345" href="Ledger.Gov.html#257" class="Bound">es</a><a id="347" class="Symbol">)</a>
                  <a id="367" class="Symbol">(</a><a id="368" href="Ledger.Gov.html#368" class="Bound">ppd</a> <a id="372" class="Symbol">:</a> <a id="374" href="Ledger.PParams.html#5164" class="Record">PParamsDiff</a><a id="385" class="Symbol">)</a>
                  <a id="405" class="Symbol">(</a><a id="406" href="Ledger.Gov.html#406" class="Bound">ppHashable</a> <a id="417" class="Symbol">:</a> <a id="419" href="Ledger.Crypto.html#190" class="Record">isHashableSet</a> <a id="433" href="Ledger.PParams.html#1053" class="Record">PParams</a><a id="440" class="Symbol">)</a>
                  <a id="460" class="Symbol">(</a><a id="461" href="Ledger.Gov.html#461" class="Bound">crypto</a> <a id="468" class="Symbol">:</a> <a id="470" href="Ledger.Crypto.html#1628" class="Record">Crypto</a><a id="476" class="Symbol">)</a> <a id="478" class="Symbol">⦃</a> <a id="480" href="Ledger.Gov.html#480" class="Bound">_</a> <a id="482" class="Symbol">:</a> <a id="484" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="490" href="Ledger.Gov.html#215" class="Bound">Network</a> <a id="498" class="Symbol">⦄</a> <a id="500" class="Symbol">⦃</a> <a id="502" href="Ledger.Gov.html#502" class="Bound">_</a> <a id="504" class="Symbol">:</a> <a id="506" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="512" href="Ledger.Gov.html#210" class="Bound">TxId</a> <a id="517" class="Symbol">⦄</a> <a id="519" class="Keyword">where</a>

<a id="526" class="Keyword">import</a> <a id="533" href="Data.List.html" class="Module">Data.List</a> <a id="543" class="Symbol">as</a> <a id="546" class="Module">L</a>
<a id="548" class="Keyword">open</a> <a id="553" class="Keyword">import</a> <a id="560" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="588" class="Keyword">open</a> <a id="593" class="Keyword">import</a> <a id="600" href="Ledger.GovernanceActions.html" class="Module">Ledger.GovernanceActions</a> <a id="625" href="Ledger.Gov.html#210" class="Bound">TxId</a> <a id="630" href="Ledger.Gov.html#215" class="Bound">Network</a> <a id="638" href="Ledger.Gov.html#223" class="Bound">DocHash</a> <a id="646" href="Ledger.Gov.html#257" class="Bound">es</a> <a id="649" href="Ledger.Gov.html#368" class="Bound">ppd</a> <a id="653" href="Ledger.Gov.html#406" class="Bound">ppHashable</a> <a id="664" href="Ledger.Gov.html#461" class="Bound">crypto</a>

<a id="672" class="Keyword">open</a> <a id="677" href="Ledger.Crypto.html#1628" class="Module">Crypto</a> <a id="684" href="Ledger.Gov.html#461" class="Bound">crypto</a>

<a id="692" class="Keyword">open</a> <a id="697" class="Keyword">import</a> <a id="704" href="Ledger.Address.html" class="Module">Ledger.Address</a> <a id="719" href="Ledger.Gov.html#215" class="Bound">Network</a> <a id="727" href="Ledger.Crypto.html#1812" class="Function">KeyHash</a> <a id="735" href="Ledger.Crypto.html#1750" class="Function">ScriptHash</a>
<a id="746" class="Markup">\end{code}</a><a id="756" class="Background">
\begin{figure*}[h]
</a><a id="776" class="Markup">\begin{code}</a>
<a id="789" class="Keyword">record</a> <a id="GovActionState"></a><a id="796" href="Ledger.Gov.html#796" class="Record">GovActionState</a> <a id="811" class="Symbol">:</a> <a id="813" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="817" class="Keyword">where</a>
  <a id="825" class="Keyword">field</a> <a id="GovActionState.votes"></a><a id="831" href="Ledger.Gov.html#831" class="Field">votes</a>       <a id="843" class="Symbol">:</a> <a id="845" class="Symbol">(</a><a id="846" href="Ledger.GovernanceActions.html#1482" class="Datatype">GovRole</a> <a id="854" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="856" href="Ledger.Address.html#740" class="Function">Credential</a><a id="866" class="Symbol">)</a> <a id="868" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="870" href="Ledger.GovernanceActions.html#9022" class="Datatype">Vote</a>
        <a id="GovActionState.returnAddr"></a><a id="883" href="Ledger.Gov.html#883" class="Field">returnAddr</a>  <a id="895" class="Symbol">:</a> <a id="897" href="Ledger.Address.html#1243" class="Record">RwdAddr</a>
        <a id="GovActionState.expiresIn"></a><a id="913" href="Ledger.Gov.html#913" class="Field">expiresIn</a>   <a id="925" class="Symbol">:</a> <a id="927" href="Ledger.Epoch.html#593" class="Field">Epoch</a>
        <a id="GovActionState.action"></a><a id="941" href="Ledger.Gov.html#941" class="Field">action</a>      <a id="953" class="Symbol">:</a> <a id="955" href="Ledger.GovernanceActions.html#1770" class="Datatype">GovAction</a>
        <a id="GovActionState.prevAction"></a><a id="973" href="Ledger.Gov.html#973" class="Field">prevAction</a>  <a id="985" class="Symbol">:</a> <a id="987" href="Ledger.GovernanceActions.html#7706" class="Function">NeedsHash</a> <a id="997" href="Ledger.Gov.html#941" class="Field">action</a>

<a id="GovState"></a><a id="1005" href="Ledger.Gov.html#1005" class="Function">GovState</a> <a id="1014" class="Symbol">:</a> <a id="1016" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="1020" href="Ledger.Gov.html#1005" class="Function">GovState</a> <a id="1029" class="Symbol">=</a> <a id="1031" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1036" class="Symbol">(</a><a id="1037" href="Ledger.GovernanceActions.html#1435" class="Function">GovActionID</a> <a id="1049" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="1051" href="Ledger.Gov.html#796" class="Record">GovActionState</a><a id="1065" class="Symbol">)</a>

<a id="1068" class="Keyword">record</a> <a id="GovEnv"></a><a id="1075" href="Ledger.Gov.html#1075" class="Record">GovEnv</a> <a id="1082" class="Symbol">:</a> <a id="1084" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1088" class="Keyword">where</a>
  <a id="1096" class="Keyword">constructor</a> <a id="⟦_,_,_⟧ᵗ"></a><a id="1108" href="Ledger.Gov.html#1108" class="InductiveConstructor Operator">⟦_,_,_⟧ᵗ</a>
  <a id="1119" class="Keyword">field</a> <a id="GovEnv.txid"></a><a id="1125" href="Ledger.Gov.html#1125" class="Field">txid</a>     <a id="1134" class="Symbol">:</a> <a id="1136" href="Ledger.Gov.html#210" class="Bound">TxId</a>
        <a id="GovEnv.epoch"></a><a id="1149" href="Ledger.Gov.html#1149" class="Field">epoch</a>    <a id="1158" class="Symbol">:</a> <a id="1160" href="Ledger.Epoch.html#593" class="Field">Epoch</a>
        <a id="GovEnv.pparams"></a><a id="1174" href="Ledger.Gov.html#1174" class="Field">pparams</a>  <a id="1183" class="Symbol">:</a> <a id="1185" href="Ledger.PParams.html#1053" class="Record">PParams</a>
<a id="1193" class="Markup">\end{code}</a><a id="1203" class="Background">
</a><a id="1204" class="Markup">\begin{code}[hide]</a>
<a id="1223" class="Keyword">open</a> <a id="1228" href="Ledger.Gov.html#796" class="Module">GovActionState</a>

<a id="1244" class="Keyword">private</a>
  <a id="1254" class="Keyword">variable</a> <a id="1263" href="Ledger.Gov.html#1263" class="Generalizable">Γ</a> <a id="1265" class="Symbol">:</a> <a id="1267" href="Ledger.Gov.html#1075" class="Record">GovEnv</a>
           <a id="1285" href="Ledger.Gov.html#1285" class="Generalizable">s</a> <a id="1287" href="Ledger.Gov.html#1287" class="Generalizable">s&#39;</a> <a id="1290" class="Symbol">:</a> <a id="1292" href="Ledger.Gov.html#1005" class="Function">GovState</a>
           <a id="1312" href="Ledger.Gov.html#1312" class="Generalizable">aid</a> <a id="1316" class="Symbol">:</a> <a id="1318" href="Ledger.GovernanceActions.html#1435" class="Function">GovActionID</a>
           <a id="1341" href="Ledger.Gov.html#1341" class="Generalizable">role</a> <a id="1346" class="Symbol">:</a> <a id="1348" href="Ledger.GovernanceActions.html#1482" class="Datatype">GovRole</a>
           <a id="1367" href="Ledger.Gov.html#1367" class="Generalizable">cred</a> <a id="1372" class="Symbol">:</a> <a id="1374" href="Ledger.Address.html#740" class="Function">Credential</a>
           <a id="1396" href="Ledger.Gov.html#1396" class="Generalizable">v</a> <a id="1398" class="Symbol">:</a> <a id="1400" href="Ledger.GovernanceActions.html#9022" class="Datatype">Vote</a>
           <a id="1416" href="Ledger.Gov.html#1416" class="Generalizable">c</a> <a id="1418" href="Ledger.Gov.html#1418" class="Generalizable">d</a> <a id="1420" class="Symbol">:</a> <a id="1422" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
           <a id="1438" href="Ledger.Gov.html#1438" class="Generalizable">addr</a> <a id="1443" class="Symbol">:</a> <a id="1445" href="Ledger.Address.html#1243" class="Record">RwdAddr</a>
           <a id="1464" href="Ledger.Gov.html#1464" class="Generalizable">a</a> <a id="1466" class="Symbol">:</a> <a id="1468" href="Ledger.GovernanceActions.html#1770" class="Datatype">GovAction</a>
           <a id="1489" href="Ledger.Gov.html#1489" class="Generalizable">prev</a> <a id="1494" class="Symbol">:</a> <a id="1496" href="Ledger.GovernanceActions.html#7706" class="Function">NeedsHash</a> <a id="1506" href="Ledger.Gov.html#1464" class="Generalizable">a</a>
<a id="1508" class="Markup">\end{code}</a><a id="1518" class="Background">
</a><a id="1519" class="Markup">\begin{code}</a>
<a id="1532" class="Comment">-- could be implemented using a function of type ∀ {a} {A : Set a} → (A → Maybe A) → List A → List A</a>
<a id="modifyMatch"></a><a id="1633" href="Ledger.Gov.html#1633" class="Function">modifyMatch</a> <a id="1645" class="Symbol">:</a> <a id="1647" class="Symbol">∀</a> <a id="1649" class="Symbol">{</a><a id="1650" href="Ledger.Gov.html#1650" class="Bound">a</a><a id="1651" class="Symbol">}</a> <a id="1653" class="Symbol">{</a><a id="1654" href="Ledger.Gov.html#1654" class="Bound">A</a> <a id="1656" class="Symbol">:</a> <a id="1658" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1662" href="Ledger.Gov.html#1650" class="Bound">a</a><a id="1663" class="Symbol">}</a> <a id="1665" class="Symbol">→</a> <a id="1667" class="Symbol">(</a><a id="1668" href="Ledger.Gov.html#1654" class="Bound">A</a> <a id="1670" class="Symbol">→</a> <a id="1672" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a><a id="1676" class="Symbol">)</a> <a id="1678" class="Symbol">→</a> <a id="1680" class="Symbol">(</a><a id="1681" href="Ledger.Gov.html#1654" class="Bound">A</a> <a id="1683" class="Symbol">→</a> <a id="1685" href="Ledger.Gov.html#1654" class="Bound">A</a><a id="1686" class="Symbol">)</a> <a id="1688" class="Symbol">→</a> <a id="1690" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1695" href="Ledger.Gov.html#1654" class="Bound">A</a> <a id="1697" class="Symbol">→</a> <a id="1699" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1704" href="Ledger.Gov.html#1654" class="Bound">A</a>
<a id="1706" href="Ledger.Gov.html#1633" class="Function">modifyMatch</a> <a id="1718" href="Ledger.Gov.html#1718" class="Bound">P</a> <a id="1720" href="Ledger.Gov.html#1720" class="Bound">f</a> <a id="1722" class="Symbol">=</a> <a id="1724" href="Data.List.Base.html#1606" class="Function">L.map</a> <a id="1730" class="Symbol">(λ</a> <a id="1733" href="Ledger.Gov.html#1733" class="Bound">x</a> <a id="1735" class="Symbol">→</a> <a id="1737" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="1740" href="Ledger.Gov.html#1718" class="Bound">P</a> <a id="1742" href="Ledger.Gov.html#1733" class="Bound">x</a> <a id="1744" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="1749" href="Ledger.Gov.html#1720" class="Bound">f</a> <a id="1751" href="Ledger.Gov.html#1733" class="Bound">x</a> <a id="1753" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="1758" href="Ledger.Gov.html#1733" class="Bound">x</a><a id="1759" class="Symbol">)</a>

<a id="addVote"></a><a id="1762" href="Ledger.Gov.html#1762" class="Function">addVote</a> <a id="1770" class="Symbol">:</a> <a id="1772" href="Ledger.Gov.html#1005" class="Function">GovState</a> <a id="1781" class="Symbol">→</a> <a id="1783" href="Ledger.GovernanceActions.html#1435" class="Function">GovActionID</a> <a id="1795" class="Symbol">→</a> <a id="1797" href="Ledger.GovernanceActions.html#1482" class="Datatype">GovRole</a> <a id="1805" class="Symbol">→</a> <a id="1807" href="Ledger.Address.html#740" class="Function">Credential</a> <a id="1818" class="Symbol">→</a> <a id="1820" href="Ledger.GovernanceActions.html#9022" class="Datatype">Vote</a> <a id="1825" class="Symbol">→</a> <a id="1827" href="Ledger.Gov.html#1005" class="Function">GovState</a>
<a id="1836" href="Ledger.Gov.html#1762" class="Function">addVote</a> <a id="1844" href="Ledger.Gov.html#1844" class="Bound">s</a> <a id="1846" href="Ledger.Gov.html#1846" class="Bound">aid</a> <a id="1850" href="Ledger.Gov.html#1850" class="Bound">r</a> <a id="1852" href="Ledger.Gov.html#1852" class="Bound">kh</a> <a id="1855" href="Ledger.Gov.html#1855" class="Bound">v</a> <a id="1857" class="Symbol">=</a>
  <a id="1861" href="Ledger.Gov.html#1633" class="Function">modifyMatch</a> <a id="1873" class="Symbol">(λ</a> <a id="1876" href="Ledger.Gov.html#1876" class="Bound">x</a> <a id="1878" class="Symbol">→</a> <a id="1880" href="Relation.Nullary.Decidable.Core.html#3274" class="Function Operator">⌊</a> <a id="1882" href="Ledger.Gov.html#1846" class="Bound">aid</a> <a id="1886" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="1888" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="1894" href="Ledger.Gov.html#1876" class="Bound">x</a> <a id="1896" href="Relation.Nullary.Decidable.Core.html#3274" class="Function Operator">⌋</a><a id="1897" class="Symbol">)</a>
              <a id="1913" class="Symbol">(λ</a> <a id="1916" class="Keyword">where</a> <a id="1922" class="Symbol">(</a><a id="1923" href="Ledger.Gov.html#1923" class="Bound">gid</a> <a id="1927" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1929" href="Ledger.Gov.html#1929" class="Bound">s&#39;</a><a id="1931" class="Symbol">)</a> <a id="1933" class="Symbol">→</a> <a id="1935" href="Ledger.Gov.html#1923" class="Bound">gid</a> <a id="1939" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1941" class="Keyword">record</a> <a id="1948" href="Ledger.Gov.html#1929" class="Bound">s&#39;</a> <a id="1951" class="Symbol">{</a> <a id="1953" href="Ledger.Gov.html#831" class="Field">votes</a> <a id="1959" class="Symbol">=</a> <a id="1961" href="Axiom.Set.Map.html#5115" class="Function">insert</a> <a id="1968" class="Symbol">(</a><a id="1969" href="Ledger.Gov.html#831" class="Field">votes</a> <a id="1975" href="Ledger.Gov.html#1929" class="Bound">s&#39;</a><a id="1977" class="Symbol">)</a> <a id="1979" class="Symbol">(</a><a id="1980" href="Ledger.Gov.html#1850" class="Bound">r</a> <a id="1982" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1984" href="Ledger.Gov.html#1852" class="Bound">kh</a><a id="1986" class="Symbol">)</a> <a id="1988" href="Ledger.Gov.html#1855" class="Bound">v</a> <a id="1990" class="Symbol">})</a> <a id="1993" href="Ledger.Gov.html#1844" class="Bound">s</a>

<a id="addAction"></a><a id="1996" href="Ledger.Gov.html#1996" class="Function">addAction</a> <a id="2006" class="Symbol">:</a> <a id="2008" href="Ledger.Gov.html#1005" class="Function">GovState</a> <a id="2017" class="Symbol">→</a> <a id="2019" href="Ledger.Epoch.html#593" class="Field">Epoch</a> <a id="2025" class="Symbol">→</a> <a id="2027" href="Ledger.GovernanceActions.html#1435" class="Function">GovActionID</a> <a id="2039" class="Symbol">→</a> <a id="2041" href="Ledger.Address.html#1243" class="Record">RwdAddr</a> <a id="2049" class="Symbol">→</a> <a id="2051" class="Symbol">(</a><a id="2052" href="Ledger.Gov.html#2052" class="Bound">a</a> <a id="2054" class="Symbol">:</a> <a id="2056" href="Ledger.GovernanceActions.html#1770" class="Datatype">GovAction</a><a id="2065" class="Symbol">)</a> <a id="2067" class="Symbol">→</a> <a id="2069" href="Ledger.GovernanceActions.html#7706" class="Function">NeedsHash</a> <a id="2079" href="Ledger.Gov.html#2052" class="Bound">a</a> <a id="2081" class="Symbol">→</a> <a id="2083" href="Ledger.Gov.html#1005" class="Function">GovState</a>
<a id="2092" href="Ledger.Gov.html#1996" class="Function">addAction</a> <a id="2102" href="Ledger.Gov.html#2102" class="Bound">s</a> <a id="2104" href="Ledger.Gov.html#2104" class="Bound">e</a> <a id="2106" href="Ledger.Gov.html#2106" class="Bound">aid</a> <a id="2110" href="Ledger.Gov.html#2110" class="Bound">addr</a> <a id="2115" href="Ledger.Gov.html#2115" class="Bound">a</a> <a id="2117" href="Ledger.Gov.html#2117" class="Bound">prev</a> <a id="2122" class="Symbol">=</a> <a id="2124" href="Ledger.Gov.html#2102" class="Bound">s</a> <a id="2126" href="Data.List.Base.html#7213" class="Function Operator">∷ʳ</a> <a id="2129" class="Symbol">(</a><a id="2130" href="Ledger.Gov.html#2106" class="Bound">aid</a> <a id="2134" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2136" class="Keyword">record</a>
  <a id="2145" class="Symbol">{</a> <a id="2147" href="Ledger.Gov.html#831" class="Field">votes</a> <a id="2153" class="Symbol">=</a> <a id="2155" href="Axiom.Set.Map.html#2707" class="Function">∅ᵐ</a> <a id="2158" class="Symbol">;</a> <a id="2160" href="Ledger.Gov.html#883" class="Field">returnAddr</a> <a id="2171" class="Symbol">=</a> <a id="2173" href="Ledger.Gov.html#2110" class="Bound">addr</a> <a id="2178" class="Symbol">;</a> <a id="2180" href="Ledger.Gov.html#913" class="Field">expiresIn</a> <a id="2190" class="Symbol">=</a> <a id="2192" href="Ledger.Gov.html#2104" class="Bound">e</a> <a id="2194" class="Symbol">;</a> <a id="2196" href="Ledger.Gov.html#941" class="Field">action</a> <a id="2203" class="Symbol">=</a> <a id="2205" href="Ledger.Gov.html#2115" class="Bound">a</a> <a id="2207" class="Symbol">;</a> <a id="2209" href="Ledger.Gov.html#973" class="Field">prevAction</a> <a id="2220" class="Symbol">=</a> <a id="2222" href="Ledger.Gov.html#2117" class="Bound">prev</a> <a id="2227" class="Symbol">})</a>

<a id="2231" class="Comment">-- x is the anchor in those two cases, which we don&#39;t do anything with</a>
<a id="2302" class="Keyword">data</a> <a id="_⊢_⇀⦇_,GOV&#39;⦈_"></a><a id="2307" href="Ledger.Gov.html#2307" class="Datatype Operator">_⊢_⇀⦇_,GOV&#39;⦈_</a> <a id="2321" class="Symbol">:</a> <a id="2323" href="Ledger.Gov.html#1075" class="Record">GovEnv</a> <a id="2330" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="2332" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="2334" class="Symbol">→</a> <a id="2336" href="Ledger.Gov.html#1005" class="Function">GovState</a> <a id="2345" class="Symbol">→</a> <a id="2347" href="Ledger.GovernanceActions.html#9101" class="Record">GovVote</a> <a id="2355" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="2357" href="Ledger.GovernanceActions.html#9288" class="Record">GovProposal</a> <a id="2369" class="Symbol">→</a> <a id="2371" href="Ledger.Gov.html#1005" class="Function">GovState</a> <a id="2380" class="Symbol">→</a> <a id="2382" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2386" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,GOV&#39;⦈_.GOV-Vote"></a><a id="2394" href="Ledger.Gov.html#2394" class="InductiveConstructor">GOV-Vote</a> <a id="2403" class="Symbol">:</a> <a id="2405" class="Symbol">∀</a> <a id="2407" class="Symbol">{</a><a id="2408" href="Ledger.Gov.html#2408" class="Bound">x</a> <a id="2410" href="Ledger.Gov.html#2410" class="Bound">k</a><a id="2411" class="Symbol">}</a> <a id="2413" class="Symbol">→</a> <a id="2415" class="Keyword">let</a> <a id="2419" class="Keyword">open</a> <a id="2424" href="Ledger.Gov.html#1075" class="Module">GovEnv</a> <a id="2431" href="Ledger.Gov.html#1263" class="Generalizable">Γ</a> <a id="2433" class="Keyword">in</a>
    <a id="2440" href="Ledger.Gov.html#1312" class="Generalizable">aid</a> <a id="2444" href="Axiom.Set.html#1806" class="Function Operator">∈</a> <a id="2446" href="Ledger.Prelude.html#2334" class="Function">setFromList</a> <a id="2458" class="Symbol">(</a><a id="2459" href="Data.List.Base.html#1606" class="Function">L.map</a> <a id="2465" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="2471" href="Ledger.Gov.html#1285" class="Generalizable">s</a><a id="2472" class="Symbol">)</a>
    <a id="2478" href="Interface.STS.html#211" class="Function Operator">────────────────────────────────</a>
    <a id="2515" class="Symbol">(</a><a id="2516" href="Ledger.Gov.html#1263" class="Generalizable">Γ</a> <a id="2518" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2520" href="Ledger.Gov.html#2410" class="Bound">k</a><a id="2521" class="Symbol">)</a> <a id="2523" href="Ledger.Gov.html#2307" class="Datatype Operator">⊢</a> <a id="2525" href="Ledger.Gov.html#1285" class="Generalizable">s</a> <a id="2527" href="Ledger.Gov.html#2307" class="Datatype Operator">⇀⦇</a> <a id="2530" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="2535" class="Keyword">record</a> <a id="2542" class="Symbol">{</a> <a id="2544" href="Ledger.GovernanceActions.html#9129" class="Field">gid</a> <a id="2548" class="Symbol">=</a> <a id="2550" href="Ledger.Gov.html#1312" class="Generalizable">aid</a> <a id="2554" class="Symbol">;</a> <a id="2556" href="Ledger.GovernanceActions.html#9163" class="Field">role</a> <a id="2561" class="Symbol">=</a> <a id="2563" href="Ledger.Gov.html#1341" class="Generalizable">role</a> <a id="2568" class="Symbol">;</a> <a id="2570" href="Ledger.GovernanceActions.html#9193" class="Field">credential</a> <a id="2581" class="Symbol">=</a> <a id="2583" href="Ledger.Gov.html#1367" class="Generalizable">cred</a> <a id="2588" class="Symbol">;</a> <a id="2590" href="Ledger.GovernanceActions.html#9226" class="Field">vote</a> <a id="2595" class="Symbol">=</a> <a id="2597" href="Ledger.Gov.html#1396" class="Generalizable">v</a> <a id="2599" class="Symbol">;</a> <a id="2601" href="Ledger.GovernanceActions.html#9253" class="Field">anchor</a> <a id="2608" class="Symbol">=</a> <a id="2610" href="Ledger.Gov.html#2408" class="Bound">x</a> <a id="2612" class="Symbol">}</a> <a id="2614" href="Ledger.Gov.html#2307" class="Datatype Operator">,GOV&#39;⦈</a>
              <a id="2635" href="Ledger.Gov.html#1762" class="Function">addVote</a> <a id="2643" href="Ledger.Gov.html#1285" class="Generalizable">s</a> <a id="2645" href="Ledger.Gov.html#1312" class="Generalizable">aid</a> <a id="2649" href="Ledger.Gov.html#1341" class="Generalizable">role</a> <a id="2654" href="Ledger.Gov.html#1367" class="Generalizable">cred</a> <a id="2659" href="Ledger.Gov.html#1396" class="Generalizable">v</a>

  <a id="_⊢_⇀⦇_,GOV&#39;⦈_.GOV-Propose"></a><a id="2664" href="Ledger.Gov.html#2664" class="InductiveConstructor">GOV-Propose</a> <a id="2676" class="Symbol">:</a> <a id="2678" class="Symbol">∀</a> <a id="2680" class="Symbol">{</a><a id="2681" href="Ledger.Gov.html#2681" class="Bound">x</a> <a id="2683" href="Ledger.Gov.html#2683" class="Bound">k</a><a id="2684" class="Symbol">}</a> <a id="2686" class="Symbol">→</a> <a id="2688" class="Keyword">let</a> <a id="2692" class="Keyword">open</a> <a id="2697" href="Ledger.Gov.html#1075" class="Module">GovEnv</a> <a id="2704" href="Ledger.Gov.html#1263" class="Generalizable">Γ</a><a id="2705" class="Symbol">;</a> <a id="2707" class="Keyword">open</a> <a id="2712" href="Ledger.PParams.html#1053" class="Module">PParams</a> <a id="2720" href="Ledger.Gov.html#1174" class="Function">pparams</a> <a id="2728" class="Keyword">using</a> <a id="2734" class="Symbol">(</a><a id="2735" href="Ledger.PParams.html#2091" class="Field">govExpiration</a><a id="2748" class="Symbol">;</a> <a id="2750" href="Ledger.PParams.html#2122" class="Field">govDeposit</a><a id="2760" class="Symbol">)</a> <a id="2762" class="Keyword">in</a>
    <a id="2769" href="Ledger.GovernanceActions.html#5514" class="Function">actionWellFormed</a> <a id="2786" href="Ledger.Gov.html#1464" class="Generalizable">a</a> <a id="2788" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="2790" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
    <a id="2799" class="Symbol">→</a> <a id="2801" href="Ledger.Gov.html#1418" class="Generalizable">d</a> <a id="2803" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="2805" href="Ledger.PParams.html#2122" class="Function">govDeposit</a>
    <a id="2820" href="Interface.STS.html#211" class="Function Operator">────────────────────────────────</a>
    <a id="2857" class="Symbol">(</a><a id="2858" href="Ledger.Gov.html#1263" class="Generalizable">Γ</a> <a id="2860" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2862" href="Ledger.Gov.html#2683" class="Bound">k</a><a id="2863" class="Symbol">)</a> <a id="2865" href="Ledger.Gov.html#2307" class="Datatype Operator">⊢</a> <a id="2867" href="Ledger.Gov.html#1285" class="Generalizable">s</a> <a id="2869" href="Ledger.Gov.html#2307" class="Datatype Operator">⇀⦇</a> <a id="2872" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="2877" class="Keyword">record</a> <a id="2884" class="Symbol">{</a> <a id="2886" href="Ledger.GovernanceActions.html#9320" class="Field">returnAddr</a> <a id="2897" class="Symbol">=</a> <a id="2899" href="Ledger.Gov.html#1438" class="Generalizable">addr</a> <a id="2904" class="Symbol">;</a> <a id="2906" href="Ledger.GovernanceActions.html#9350" class="Field">action</a> <a id="2913" class="Symbol">=</a> <a id="2915" href="Ledger.Gov.html#1464" class="Generalizable">a</a> <a id="2917" class="Symbol">;</a> <a id="2919" href="Ledger.GovernanceActions.html#9448" class="Field">anchor</a> <a id="2926" class="Symbol">=</a> <a id="2928" href="Ledger.Gov.html#2681" class="Bound">x</a> <a id="2930" class="Symbol">;</a> <a id="2932" href="Ledger.GovernanceActions.html#9421" class="Field">deposit</a> <a id="2940" class="Symbol">=</a> <a id="2942" href="Ledger.Gov.html#1418" class="Generalizable">d</a> <a id="2944" class="Symbol">;</a> <a id="2946" href="Ledger.GovernanceActions.html#9382" class="Field">prevAction</a> <a id="2957" class="Symbol">=</a> <a id="2959" href="Ledger.Gov.html#1489" class="Generalizable">prev</a> <a id="2964" class="Symbol">}</a> <a id="2966" href="Ledger.Gov.html#2307" class="Datatype Operator">,GOV&#39;⦈</a>
              <a id="2987" href="Ledger.Gov.html#1996" class="Function">addAction</a> <a id="2997" href="Ledger.Gov.html#1285" class="Generalizable">s</a> <a id="2999" class="Symbol">(</a><a id="3000" href="Ledger.PParams.html#2091" class="Function">govExpiration</a> <a id="3014" href="Ledger.Epoch.html#1127" class="Function Operator">+ᵉ</a> <a id="3017" href="Ledger.Gov.html#1149" class="Function">epoch</a><a id="3022" class="Symbol">)</a> <a id="3024" class="Symbol">(</a><a id="3025" href="Ledger.Gov.html#1125" class="Function">txid</a> <a id="3030" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3032" href="Ledger.Gov.html#2683" class="Bound">k</a><a id="3033" class="Symbol">)</a> <a id="3035" href="Ledger.Gov.html#1438" class="Generalizable">addr</a> <a id="3040" href="Ledger.Gov.html#1464" class="Generalizable">a</a> <a id="3042" href="Ledger.Gov.html#1489" class="Generalizable">prev</a>

<a id="_⊢_⇀⦇_,GOV⦈_"></a><a id="3048" href="Ledger.Gov.html#3048" class="Function Operator">_⊢_⇀⦇_,GOV⦈_</a> <a id="3061" class="Symbol">:</a> <a id="3063" href="Ledger.Gov.html#1075" class="Record">GovEnv</a> <a id="3070" class="Symbol">→</a> <a id="3072" href="Ledger.Gov.html#1005" class="Function">GovState</a> <a id="3081" class="Symbol">→</a> <a id="3083" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3088" class="Symbol">(</a><a id="3089" href="Ledger.GovernanceActions.html#9101" class="Record">GovVote</a> <a id="3097" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="3099" href="Ledger.GovernanceActions.html#9288" class="Record">GovProposal</a><a id="3110" class="Symbol">)</a> <a id="3112" class="Symbol">→</a> <a id="3114" href="Ledger.Gov.html#1005" class="Function">GovState</a> <a id="3123" class="Symbol">→</a> <a id="3125" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="3129" href="Ledger.Gov.html#3048" class="Function Operator">_⊢_⇀⦇_,GOV⦈_</a> <a id="3142" class="Symbol">=</a> <a id="3144" href="Interface.STS.html#966" class="Function">SS⇒BS</a> <a id="3150" class="Symbol">(λ</a> <a id="3153" href="Ledger.Gov.html#3153" class="Bound">Γ</a> <a id="3155" class="Symbol">→</a> <a id="3157" href="Ledger.Gov.html#3153" class="Bound">Γ</a> <a id="3159" href="Ledger.Gov.html#2307" class="Datatype Operator">⊢_⇀⦇_,GOV&#39;⦈_</a><a id="3171" class="Symbol">)</a>
<a id="3173" class="Markup">\end{code}</a><a id="3183" class="Background">
\caption{TALLY types}
\label{defs:tally-types}
\end{figure*}
</a></pre></body></html>