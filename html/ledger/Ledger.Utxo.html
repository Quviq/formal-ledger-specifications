<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Utxo</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{UTxO}
\label{sec:utxo}

\subsection{Accounting}

</a><a id="59" class="Markup">\begin{code}[hide]</a>
<a id="78" class="Symbol">{-#</a> <a id="82" class="Keyword">OPTIONS</a> <a id="90" class="Pragma">--safe</a> <a id="97" class="Symbol">#-}</a>
<a id="101" class="Symbol">{-#</a> <a id="105" class="Keyword">OPTIONS</a> <a id="113" class="Pragma">--overlapping-instances</a> <a id="137" class="Symbol">#-}</a>

<a id="142" class="Keyword">open</a> <a id="147" class="Keyword">import</a> <a id="154" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="174" class="Keyword">module</a> <a id="181" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="193" class="Symbol">(</a><a id="194" href="Ledger.Utxo.html#194" class="Bound">txs</a> <a id="198" class="Symbol">:</a> <a id="200" href="Ledger.Transaction.html#549" class="Record">TransactionStructure</a><a id="220" class="Symbol">)</a> <a id="222" class="Keyword">where</a>

<a id="229" class="Keyword">open</a> <a id="234" class="Keyword">import</a> <a id="241" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="256" class="Keyword">hiding</a> <a id="263" class="Symbol">(</a><a id="264" href="Relation.Unary.html#3685" class="Function">Dec₁</a><a id="268" class="Symbol">)</a>

<a id="271" class="Keyword">open</a> <a id="276" class="Keyword">import</a> <a id="283" href="Algebra.html" class="Module">Algebra</a> <a id="291" class="Keyword">using</a> <a id="297" class="Symbol">(</a><a id="298" href="Algebra.Bundles.html#6578" class="Record">CommutativeMonoid</a><a id="315" class="Symbol">)</a>
<a id="317" class="Keyword">open</a> <a id="322" class="Keyword">import</a> <a id="329" href="Algebra.Structures.html" class="Module">Algebra.Structures</a>
<a id="348" class="Keyword">open</a> <a id="353" class="Keyword">import</a> <a id="360" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="373" class="Keyword">using</a> <a id="379" class="Symbol">(</a><a id="380" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a><a id="381" class="Symbol">;</a> <a id="383" href="Data.Integer.Base.html#4899" class="Function Operator">_⊖_</a><a id="386" class="Symbol">)</a>
<a id="388" class="Keyword">open</a> <a id="393" class="Keyword">import</a> <a id="400" href="Data.Integer.Ext.html" class="Module">Data.Integer.Ext</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.List.html" class="Module">Data.List</a> <a id="439" class="Symbol">as</a> <a id="442" class="Module">List</a>
<a id="447" class="Keyword">open</a> <a id="452" class="Keyword">import</a> <a id="459" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="468" class="Keyword">using</a> <a id="474" class="Symbol">(</a><a id="475" href="Data.Nat.Properties.html#5872" class="Function Operator">_≤?_</a><a id="479" class="Symbol">;</a> <a id="481" href="Data.Nat.Base.html#1535" class="Datatype Operator">_≤_</a><a id="484" class="Symbol">)</a>
<a id="486" class="Keyword">open</a> <a id="491" class="Keyword">import</a> <a id="498" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="518" class="Keyword">using</a> <a id="524" class="Symbol">(</a><a id="525" href="Data.Nat.Properties.html#16387" class="Function">+-0-monoid</a> <a id="536" class="Symbol">;</a> <a id="538" href="Data.Nat.Properties.html#16466" class="Function">+-0-commutativeMonoid</a><a id="559" class="Symbol">)</a>
<a id="561" class="Keyword">open</a> <a id="566" class="Keyword">import</a> <a id="573" href="Data.Sign.html" class="Module">Data.Sign</a> <a id="583" class="Keyword">using</a> <a id="589" class="Symbol">(</a><a id="590" href="Data.Sign.Base.html#514" class="Datatype">Sign</a><a id="594" class="Symbol">)</a>
<a id="596" class="Keyword">open</a> <a id="601" class="Keyword">import</a> <a id="608" href="Interface.Decidable.Instance.html" class="Module">Interface.Decidable.Instance</a>

<a id="638" class="Keyword">open</a> <a id="643" href="Ledger.Transaction.html#549" class="Module">TransactionStructure</a> <a id="664" href="Ledger.Utxo.html#194" class="Bound">txs</a>
<a id="668" class="Keyword">open</a> <a id="673" href="Ledger.Transaction.html#3640" class="Module">TxBody</a>
<a id="680" class="Keyword">open</a> <a id="685" href="Ledger.Transaction.html#4177" class="Module">TxWitnesses</a>
<a id="697" class="Keyword">open</a> <a id="702" href="Ledger.Transaction.html#4273" class="Module">Tx</a>

<a id="706" class="Keyword">open</a> <a id="711" class="Keyword">import</a> <a id="718" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>
<a id="732" class="Keyword">open</a> <a id="737" class="Keyword">import</a> <a id="744" href="Ledger.PParams.html" class="Module">Ledger.PParams</a> <a id="759" href="Ledger.Transaction.html#1517" class="Field">epochStructure</a>
<a id="774" class="Keyword">open</a> <a id="779" class="Keyword">import</a> <a id="786" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a> <a id="806" class="Keyword">using</a> <a id="812" class="Symbol">(</a><a id="813" href="Ledger.TokenAlgebra.html#499" class="Record">TokenAlgebra</a><a id="825" class="Symbol">)</a>

<a id="828" class="Keyword">open</a> <a id="833" class="Keyword">import</a> <a id="840" href="MyDebugOptions.html" class="Module">MyDebugOptions</a>
<a id="855" class="Comment">--open import Tactic.Defaults</a>
<a id="885" class="Keyword">open</a> <a id="890" class="Keyword">import</a> <a id="897" href="Tactic.DeriveComp.html" class="Module">Tactic.DeriveComp</a>
<a id="915" class="Keyword">open</a> <a id="920" class="Keyword">import</a> <a id="927" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="948" class="Keyword">instance</a>
  <a id="959" href="Ledger.Utxo.html#959" class="Function">_</a> <a id="961" class="Symbol">=</a> <a id="963" href="Interface.Decidable.Instance.html#766" class="Function">Decidable²⇒Dec</a> <a id="978" href="Data.Nat.Properties.html#5872" class="Function Operator">_≤?_</a>
  <a id="985" href="Ledger.Utxo.html#985" class="Function">_</a> <a id="987" class="Symbol">=</a> <a id="989" href="Ledger.TokenAlgebra.html#534" class="Field">TokenAlgebra.Value-CommutativeMonoid</a> <a id="1026" href="Ledger.Transaction.html#2580" class="Field">tokenAlgebra</a>
  <a id="1041" href="Ledger.Utxo.html#1041" class="Function">_</a> <a id="1043" class="Symbol">=</a> <a id="1045" href="Data.Nat.Properties.html#16387" class="Function">+-0-monoid</a>
  <a id="1058" href="Ledger.Utxo.html#1058" class="Function">_</a> <a id="1060" class="Symbol">=</a> <a id="1062" href="Data.Nat.Properties.html#16466" class="Function">+-0-commutativeMonoid</a>

  <a id="HasCoin-Map"></a><a id="1087" href="Ledger.Utxo.html#1087" class="Function">HasCoin-Map</a> <a id="1099" class="Symbol">:</a> <a id="1101" class="Symbol">∀</a> <a id="1103" class="Symbol">{</a><a id="1104" href="Ledger.Utxo.html#1104" class="Bound">A</a><a id="1105" class="Symbol">}</a> <a id="1107" class="Symbol">→</a> <a id="1109" class="Symbol">⦃</a> <a id="1111" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="1117" href="Ledger.Utxo.html#1104" class="Bound">A</a> <a id="1119" class="Symbol">⦄</a> <a id="1121" class="Symbol">→</a> <a id="1123" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="1131" class="Symbol">(</a><a id="1132" href="Ledger.Utxo.html#1104" class="Bound">A</a> <a id="1134" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="1136" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="1140" class="Symbol">)</a>
  <a id="1144" href="Ledger.Utxo.html#1087" class="Function">HasCoin-Map</a> <a id="1156" class="Symbol">.</a><a id="1157" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="1165" href="Ledger.Utxo.html#1165" class="Bound">s</a> <a id="1167" class="Symbol">=</a> <a id="1169" href="Axiom.Set.Sum.html#4295" class="Function">Σᵐᵛ[</a> <a id="1174" href="Ledger.Utxo.html#1174" class="Bound">x</a> <a id="1176" href="Axiom.Set.Sum.html#4295" class="Function">←</a> <a id="1178" href="Ledger.Utxo.html#1165" class="Bound">s</a> <a id="1180" href="Ledger.Prelude.html#3640" class="Function Operator">ᶠᵐ</a> <a id="1183" href="Axiom.Set.Sum.html#4295" class="Function">]</a> <a id="1185" href="Ledger.Utxo.html#1174" class="Bound">x</a>


<a id="1189" class="Comment">-- utxoEntrySizeWithoutVal = 27 words (8 bytes)</a>
<a id="utxoEntrySizeWithoutVal"></a><a id="1237" href="Ledger.Utxo.html#1237" class="Function">utxoEntrySizeWithoutVal</a> <a id="1261" class="Symbol">:</a> <a id="1263" href="Ledger.TokenAlgebra.html#587" class="Function">MemoryEstimate</a>
<a id="1278" href="Ledger.Utxo.html#1237" class="Function">utxoEntrySizeWithoutVal</a> <a id="1302" class="Symbol">=</a> <a id="1304" class="Number">8</a>

<a id="utxoEntrySize"></a><a id="1307" href="Ledger.Utxo.html#1307" class="Function">utxoEntrySize</a> <a id="1321" class="Symbol">:</a> <a id="1323" href="Ledger.Transaction.html#3246" class="Function">TxOut</a> <a id="1329" class="Symbol">→</a> <a id="1331" href="Ledger.TokenAlgebra.html#587" class="Function">MemoryEstimate</a>
<a id="1346" href="Ledger.Utxo.html#1307" class="Function">utxoEntrySize</a> <a id="1360" class="Symbol">(</a><a id="1361" href="Ledger.Utxo.html#1361" class="Bound">fst</a> <a id="1365" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1367" href="Ledger.Utxo.html#1367" class="Bound">v</a><a id="1368" class="Symbol">)</a> <a id="1370" class="Symbol">=</a> <a id="1372" href="Ledger.Utxo.html#1237" class="Function">utxoEntrySizeWithoutVal</a> <a id="1396" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="1398" href="Ledger.TokenAlgebra.html#1080" class="Function">size</a> <a id="1403" href="Ledger.Utxo.html#1367" class="Bound">v</a>

<a id="1406" class="Comment">-- TODO: fix this</a>
<a id="serSize"></a><a id="1424" href="Ledger.Utxo.html#1424" class="Function">serSize</a> <a id="1432" class="Symbol">:</a> <a id="1434" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a> <a id="1440" class="Symbol">→</a> <a id="1442" href="Ledger.TokenAlgebra.html#587" class="Function">MemoryEstimate</a>
<a id="1457" href="Ledger.Utxo.html#1424" class="Function">serSize</a> <a id="1465" class="Symbol">=</a> <a id="1467" class="Symbol">λ</a> <a id="1469" href="Ledger.Utxo.html#1469" class="Bound">_</a> <a id="1471" class="Symbol">→</a> <a id="1473" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a>

<a id="1479" class="Markup">\end{code}</a><a id="1489" class="Background">

Figure~\ref{fig:functions:utxo} defines functions needed for the UTxO transition system.
Figure~\ref{fig:ts-types:utxo-shelley} defines the types needed for the UTxO transition system.
The UTxO transition system is given in Figure~\ref{fig:rules:utxo-shelley}.

\begin{itemize}

  \item
    The function $\fun{outs}$ creates the unspent outputs generated by a transaction.
    It maps the transaction id and output index to the output.

  \item
    The $\fun{balance}$ function calculates sum total of all the coin in a given UTxO.
\end{itemize}

\AgdaTarget{outs, minfee, inInterval, balance}
\begin{figure*}[h]
</a><a id="2104" class="Markup">\begin{code}</a>
<a id="outs"></a><a id="2117" href="Ledger.Utxo.html#2117" class="Function">outs</a> <a id="2122" class="Symbol">:</a> <a id="2124" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="2131" class="Symbol">→</a> <a id="2133" href="Ledger.Transaction.html#3270" class="Function">UTxO</a>
<a id="2138" href="Ledger.Utxo.html#2117" class="Function">outs</a> <a id="2143" href="Ledger.Utxo.html#2143" class="Bound">tx</a> <a id="2146" class="Symbol">=</a> <a id="2148" href="Axiom.Set.Map.html#6336" class="Function">mapKeys</a> <a id="2156" class="Symbol">(</a><a id="2157" href="Ledger.Transaction.html#4148" class="Field">txid</a> <a id="2162" href="Ledger.Utxo.html#2143" class="Bound">tx</a> <a id="2165" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,_</a><a id="2167" class="Symbol">)</a> <a id="2169" class="Symbol">(</a><a id="2170" href="Ledger.Transaction.html#3700" class="Field">txouts</a> <a id="2177" href="Ledger.Utxo.html#2143" class="Bound">tx</a><a id="2179" class="Symbol">)</a> <a id="2181" class="Symbol">λ</a> <a id="2183" class="Keyword">where</a> <a id="2189" class="Symbol">_</a> <a id="2191" class="Symbol">_</a> <a id="2193" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="2198" class="Symbol">→</a> <a id="2200" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>

<a id="balance"></a><a id="2206" href="Ledger.Utxo.html#2206" class="Function">balance</a> <a id="2214" class="Symbol">:</a> <a id="2216" href="Ledger.Transaction.html#3270" class="Function">UTxO</a> <a id="2221" class="Symbol">→</a> <a id="2223" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
<a id="2229" href="Ledger.Utxo.html#2206" class="Function">balance</a> <a id="2237" href="Ledger.Utxo.html#2237" class="Bound">utxo</a> <a id="2242" class="Symbol">=</a> <a id="2244" href="Axiom.Set.Sum.html#4295" class="Function">Σᵐᵛ[</a> <a id="2249" href="Ledger.Utxo.html#2249" class="Bound">x</a> <a id="2251" href="Axiom.Set.Sum.html#4295" class="Function">←</a> <a id="2253" href="Ledger.Utxo.html#2237" class="Bound">utxo</a> <a id="2258" href="Ledger.Prelude.html#3640" class="Function Operator">ᶠᵐ</a> <a id="2261" href="Axiom.Set.Sum.html#4295" class="Function">]</a> <a id="2263" href="Ledger.Transaction.html#4552" class="Function">getValue</a> <a id="2272" href="Ledger.Utxo.html#2249" class="Bound">x</a>

<a id="cbalance"></a><a id="2275" href="Ledger.Utxo.html#2275" class="Function">cbalance</a> <a id="2284" class="Symbol">:</a> <a id="2286" href="Ledger.Transaction.html#3270" class="Function">UTxO</a> <a id="2291" class="Symbol">→</a> <a id="2293" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="2298" href="Ledger.Utxo.html#2275" class="Function">cbalance</a> <a id="2307" href="Ledger.Utxo.html#2307" class="Bound">utxo</a> <a id="2312" class="Symbol">=</a> <a id="2314" href="Ledger.TokenAlgebra.html#924" class="Function">coin</a> <a id="2319" class="Symbol">(</a><a id="2320" href="Ledger.Utxo.html#2206" class="Function">balance</a> <a id="2328" href="Ledger.Utxo.html#2307" class="Bound">utxo</a><a id="2332" class="Symbol">)</a>

<a id="minfee"></a><a id="2335" href="Ledger.Utxo.html#2335" class="Function">minfee</a> <a id="2342" class="Symbol">:</a> <a id="2344" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="2352" class="Symbol">→</a> <a id="2354" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="2361" class="Symbol">→</a> <a id="2363" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="2368" href="Ledger.Utxo.html#2335" class="Function">minfee</a> <a id="2375" href="Ledger.Utxo.html#2375" class="Bound">pp</a> <a id="2378" href="Ledger.Utxo.html#2378" class="Bound">tx</a> <a id="2381" class="Symbol">=</a> <a id="2383" href="Ledger.PParams.html#1479" class="Function">a</a> <a id="2385" href="Agda.Builtin.Nat.html#522" class="Primitive Operator">*</a> <a id="2387" href="Ledger.Transaction.html#4122" class="Field">txsize</a> <a id="2394" href="Ledger.Utxo.html#2378" class="Bound">tx</a> <a id="2397" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="2399" href="Ledger.PParams.html#1510" class="Function">b</a>
  <a id="2403" class="Keyword">where</a> <a id="2409" class="Keyword">open</a> <a id="2414" href="Ledger.PParams.html#1053" class="Module">PParams</a> <a id="2422" href="Ledger.Utxo.html#2375" class="Bound">pp</a>

<a id="2426" class="Keyword">data</a> <a id="DepositPurpose"></a><a id="2431" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="2446" class="Symbol">:</a> <a id="2448" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2452" class="Keyword">where</a>
  <a id="DepositPurpose.CredentialDeposit"></a><a id="2460" href="Ledger.Utxo.html#2460" class="InductiveConstructor">CredentialDeposit</a>  <a id="2479" class="Symbol">:</a> <a id="2481" href="Ledger.Address.html#740" class="Function">Credential</a>  <a id="2493" class="Symbol">→</a> <a id="2495" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a>
  <a id="DepositPurpose.PoolDeposit"></a><a id="2512" href="Ledger.Utxo.html#2512" class="InductiveConstructor">PoolDeposit</a>        <a id="2531" class="Symbol">:</a> <a id="2533" href="Ledger.Address.html#740" class="Function">Credential</a>  <a id="2545" class="Symbol">→</a> <a id="2547" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a>
  <a id="DepositPurpose.DRepDeposit"></a><a id="2564" href="Ledger.Utxo.html#2564" class="InductiveConstructor">DRepDeposit</a>        <a id="2583" class="Symbol">:</a> <a id="2585" href="Ledger.Address.html#740" class="Function">Credential</a>  <a id="2597" class="Symbol">→</a> <a id="2599" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a>
  <a id="DepositPurpose.GovActionDeposit"></a><a id="2616" href="Ledger.Utxo.html#2616" class="InductiveConstructor">GovActionDeposit</a>   <a id="2635" class="Symbol">:</a> <a id="2637" href="Ledger.GovernanceActions.html#1435" class="Function">GovActionID</a> <a id="2649" class="Symbol">→</a> <a id="2651" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a>

<a id="certDeposit"></a><a id="2667" href="Ledger.Utxo.html#2667" class="Function">certDeposit</a> <a id="2679" class="Symbol">:</a> <a id="2681" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="2689" class="Symbol">→</a> <a id="2691" href="Ledger.Deleg.html#832" class="Datatype">DCert</a> <a id="2697" class="Symbol">→</a> <a id="2699" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="2705" class="Symbol">(</a><a id="2706" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="2721" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="2723" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="2727" class="Symbol">)</a>
<a id="2729" href="Ledger.Utxo.html#2667" class="Function">certDeposit</a> <a id="2741" class="Symbol">_</a>   <a id="2745" class="Symbol">(</a><a id="2746" href="Ledger.Deleg.html#852" class="InductiveConstructor">delegate</a> <a id="2755" href="Ledger.Utxo.html#2755" class="Bound">c</a> <a id="2757" class="Symbol">_</a> <a id="2759" class="Symbol">_</a> <a id="2761" href="Ledger.Utxo.html#2761" class="Bound">v</a><a id="2762" class="Symbol">)</a>  <a id="2765" class="Symbol">=</a> <a id="2767" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2772" class="Symbol">(</a><a id="2773" href="Ledger.Utxo.html#2460" class="InductiveConstructor">CredentialDeposit</a> <a id="2791" href="Ledger.Utxo.html#2755" class="Bound">c</a> <a id="2793" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2795" href="Ledger.Utxo.html#2761" class="Bound">v</a><a id="2796" class="Symbol">)</a>
<a id="2798" href="Ledger.Utxo.html#2667" class="Function">certDeposit</a> <a id="2810" href="Ledger.Utxo.html#2810" class="Bound">pp</a>  <a id="2814" class="Symbol">(</a><a id="2815" href="Ledger.Deleg.html#928" class="InductiveConstructor">regpool</a> <a id="2823" href="Ledger.Utxo.html#2823" class="Bound">c</a> <a id="2825" class="Symbol">_)</a>       <a id="2834" class="Symbol">=</a> <a id="2836" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2841" class="Symbol">(</a><a id="2842" href="Ledger.Utxo.html#2512" class="InductiveConstructor">PoolDeposit</a>       <a id="2860" href="Ledger.Utxo.html#2823" class="Bound">c</a> <a id="2862" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2864" href="Ledger.PParams.html#1575" class="Field">PParams.poolDeposit</a> <a id="2884" href="Ledger.Utxo.html#2810" class="Bound">pp</a><a id="2886" class="Symbol">)</a>
<a id="2888" href="Ledger.Utxo.html#2667" class="Function">certDeposit</a> <a id="2900" class="Symbol">_</a>   <a id="2904" class="Symbol">(</a><a id="2905" href="Ledger.Deleg.html#1019" class="InductiveConstructor">regdrep</a> <a id="2913" href="Ledger.Utxo.html#2913" class="Bound">c</a> <a id="2915" href="Ledger.Utxo.html#2915" class="Bound">v</a> <a id="2917" class="Symbol">_)</a>     <a id="2924" class="Symbol">=</a> <a id="2926" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2931" class="Symbol">(</a><a id="2932" href="Ledger.Utxo.html#2564" class="InductiveConstructor">DRepDeposit</a>       <a id="2950" href="Ledger.Utxo.html#2913" class="Bound">c</a> <a id="2952" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2954" href="Ledger.Utxo.html#2915" class="Bound">v</a><a id="2955" class="Symbol">)</a>
<a id="2957" href="Ledger.Utxo.html#2667" class="CatchallClause Function">certDeposit</a><a id="2968" class="CatchallClause"> </a><a id="2969" class="CatchallClause Symbol">_</a><a id="2970" class="CatchallClause">   </a><a id="2973" class="CatchallClause Symbol">_</a>                   <a id="2993" class="Symbol">=</a> <a id="2995" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

<a id="certDepositᵐ"></a><a id="3004" href="Ledger.Utxo.html#3004" class="Function">certDepositᵐ</a> <a id="3017" class="Symbol">:</a> <a id="3019" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="3027" class="Symbol">→</a> <a id="3029" href="Ledger.Deleg.html#832" class="Datatype">DCert</a> <a id="3035" class="Symbol">→</a> <a id="3037" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="3052" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="3054" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="3059" href="Ledger.Utxo.html#3004" class="Function">certDepositᵐ</a> <a id="3072" href="Ledger.Utxo.html#3072" class="Bound">pp</a> <a id="3075" href="Ledger.Utxo.html#3075" class="Bound">cert</a> <a id="3080" class="Symbol">=</a> <a id="3082" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="3087" href="Ledger.Utxo.html#2667" class="Function">certDeposit</a> <a id="3099" href="Ledger.Utxo.html#3072" class="Bound">pp</a> <a id="3102" href="Ledger.Utxo.html#3075" class="Bound">cert</a> <a id="3107" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="3110" class="Symbol">λ</a> <a id="3112" class="Keyword">where</a>
  <a id="3120" class="Symbol">(</a><a id="3121" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3126" class="Symbol">(</a><a id="3127" href="Ledger.Utxo.html#3127" class="Bound">p</a> <a id="3129" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3131" href="Ledger.Utxo.html#3131" class="Bound">v</a><a id="3132" class="Symbol">))</a>  <a id="3136" class="Symbol">→</a> <a id="3138" href="Axiom.Set.Map.html#4471" class="Function Operator">❴</a> <a id="3140" href="Ledger.Utxo.html#3127" class="Bound">p</a> <a id="3142" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3144" href="Ledger.Utxo.html#3131" class="Bound">v</a> <a id="3146" href="Axiom.Set.Map.html#4471" class="Function Operator">❵ᵐ</a>
  <a id="3151" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>         <a id="3167" class="Symbol">→</a> <a id="3169" href="Axiom.Set.Map.html#2707" class="Function">∅ᵐ</a>

<a id="certRefund"></a><a id="3173" href="Ledger.Utxo.html#3173" class="Function">certRefund</a> <a id="3184" class="Symbol">:</a> <a id="3186" href="Ledger.Deleg.html#832" class="Datatype">DCert</a> <a id="3192" class="Symbol">→</a> <a id="3194" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3200" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a>
<a id="3215" href="Ledger.Utxo.html#3173" class="Function">certRefund</a> <a id="3226" class="Symbol">(</a><a id="3227" href="Ledger.Deleg.html#852" class="InductiveConstructor">delegate</a> <a id="3236" href="Ledger.Utxo.html#3236" class="Bound">c</a> <a id="3238" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="3246" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="3254" href="Ledger.Utxo.html#3254" class="Bound">x</a><a id="3255" class="Symbol">)</a>  <a id="3258" class="Symbol">=</a> <a id="3260" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3265" class="Symbol">(</a><a id="3266" href="Ledger.Utxo.html#2460" class="InductiveConstructor">CredentialDeposit</a> <a id="3284" href="Ledger.Utxo.html#3236" class="Bound">c</a><a id="3285" class="Symbol">)</a>
<a id="3287" href="Ledger.Utxo.html#3173" class="Function">certRefund</a> <a id="3298" class="Symbol">(</a><a id="3299" href="Ledger.Deleg.html#1070" class="InductiveConstructor">deregdrep</a> <a id="3309" href="Ledger.Utxo.html#3309" class="Bound">c</a><a id="3310" class="Symbol">)</a>                   <a id="3330" class="Symbol">=</a> <a id="3332" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3337" class="Symbol">(</a><a id="3338" href="Ledger.Utxo.html#2564" class="InductiveConstructor">DRepDeposit</a>       <a id="3356" href="Ledger.Utxo.html#3309" class="Bound">c</a><a id="3357" class="Symbol">)</a>
<a id="3359" href="Ledger.Utxo.html#3173" class="CatchallClause Function">certRefund</a><a id="3369" class="CatchallClause"> </a><a id="3370" class="CatchallClause Symbol">_</a>                               <a id="3402" class="Symbol">=</a> <a id="3404" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

<a id="certRefundˢ"></a><a id="3413" href="Ledger.Utxo.html#3413" class="Function">certRefundˢ</a> <a id="3425" class="Symbol">:</a> <a id="3427" href="Ledger.Deleg.html#832" class="Datatype">DCert</a> <a id="3433" class="Symbol">→</a> <a id="3435" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="3437" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a>
<a id="3452" href="Ledger.Utxo.html#3413" class="Function">certRefundˢ</a> <a id="3464" class="Symbol">=</a> <a id="3466" href="Axiom.Set.html#6350" class="Function">partialToSet</a> <a id="3479" href="Ledger.Utxo.html#3173" class="Function">certRefund</a>

<a id="propDepositᵐ"></a><a id="3491" href="Ledger.Utxo.html#3491" class="Function">propDepositᵐ</a> <a id="3504" class="Symbol">:</a> <a id="3506" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="3514" class="Symbol">→</a> <a id="3516" href="Ledger.GovernanceActions.html#1435" class="Function">GovActionID</a> <a id="3528" class="Symbol">→</a> <a id="3530" href="Ledger.GovernanceActions.html#9288" class="Record">GovProposal</a> <a id="3542" class="Symbol">→</a> <a id="3544" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="3559" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="3561" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="3566" href="Ledger.Utxo.html#3491" class="Function">propDepositᵐ</a> <a id="3579" href="Ledger.Utxo.html#3579" class="Bound">pp</a> <a id="3582" href="Ledger.Utxo.html#3582" class="Bound">gaid</a> <a id="3587" class="Keyword">record</a> <a id="3594" class="Symbol">{</a> <a id="3596" href="Ledger.GovernanceActions.html#9320" class="Field">returnAddr</a> <a id="3607" class="Symbol">=</a> <a id="3609" class="Keyword">record</a> <a id="3616" class="Symbol">{</a> <a id="3618" href="Ledger.Address.html#1296" class="Field">stake</a> <a id="3624" class="Symbol">=</a> <a id="3626" href="Ledger.Utxo.html#3626" class="Bound">c</a> <a id="3628" class="Symbol">}</a> <a id="3630" class="Symbol">}</a>
  <a id="3634" class="Symbol">=</a> <a id="3636" href="Axiom.Set.Map.html#4471" class="Function Operator">❴</a> <a id="3638" href="Ledger.Utxo.html#2616" class="InductiveConstructor">GovActionDeposit</a> <a id="3655" href="Ledger.Utxo.html#3582" class="Bound">gaid</a> <a id="3660" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3662" href="Ledger.PParams.html#2122" class="Field">PParams.govDeposit</a> <a id="3681" href="Ledger.Utxo.html#3579" class="Bound">pp</a> <a id="3684" href="Axiom.Set.Map.html#4471" class="Function Operator">❵ᵐ</a>

<a id="3688" class="Comment">-- this has to be a type definition for inference to work</a>
<a id="3746" class="Keyword">data</a> <a id="inInterval"></a><a id="3751" href="Ledger.Utxo.html#3751" class="Datatype">inInterval</a> <a id="3762" class="Symbol">(</a><a id="3763" href="Ledger.Utxo.html#3763" class="Bound">slot</a> <a id="3768" class="Symbol">:</a> <a id="3770" href="Ledger.Epoch.html#608" class="Function">Slot</a><a id="3774" class="Symbol">)</a> <a id="3776" class="Symbol">:</a> <a id="3778" class="Symbol">(</a><a id="3779" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3785" href="Ledger.Epoch.html#608" class="Function">Slot</a> <a id="3790" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3792" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3798" href="Ledger.Epoch.html#608" class="Function">Slot</a><a id="3802" class="Symbol">)</a> <a id="3804" class="Symbol">→</a> <a id="3806" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3810" class="Keyword">where</a>
  <a id="inInterval.both"></a><a id="3818" href="Ledger.Utxo.html#3818" class="InductiveConstructor">both</a>  <a id="3824" class="Symbol">:</a> <a id="3826" class="Symbol">∀</a> <a id="3828" class="Symbol">{</a><a id="3829" href="Ledger.Utxo.html#3829" class="Bound">l</a> <a id="3831" href="Ledger.Utxo.html#3831" class="Bound">r</a><a id="3832" class="Symbol">}</a> <a id="3834" class="Symbol">→</a> <a id="3836" href="Ledger.Utxo.html#3829" class="Bound">l</a> <a id="3838" href="Ledger.Epoch.html#935" class="Function Operator">≤ˢ</a> <a id="3841" href="Ledger.Utxo.html#3763" class="Bound">slot</a> <a id="3846" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3848" href="Ledger.Utxo.html#3763" class="Bound">slot</a> <a id="3853" href="Ledger.Epoch.html#935" class="Function Operator">≤ˢ</a> <a id="3856" href="Ledger.Utxo.html#3831" class="Bound">r</a>  <a id="3859" class="Symbol">→</a>  <a id="3862" href="Ledger.Utxo.html#3751" class="Datatype">inInterval</a> <a id="3873" href="Ledger.Utxo.html#3763" class="Bound">slot</a> <a id="3878" class="Symbol">(</a><a id="3879" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3884" href="Ledger.Utxo.html#3829" class="Bound">l</a>  <a id="3887" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3889" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3894" href="Ledger.Utxo.html#3831" class="Bound">r</a><a id="3895" class="Symbol">)</a>
  <a id="inInterval.lower"></a><a id="3899" href="Ledger.Utxo.html#3899" class="InductiveConstructor">lower</a> <a id="3905" class="Symbol">:</a> <a id="3907" class="Symbol">∀</a> <a id="3909" class="Symbol">{</a><a id="3910" href="Ledger.Utxo.html#3910" class="Bound">l</a><a id="3911" class="Symbol">}</a>   <a id="3915" class="Symbol">→</a> <a id="3917" href="Ledger.Utxo.html#3910" class="Bound">l</a> <a id="3919" href="Ledger.Epoch.html#935" class="Function Operator">≤ˢ</a> <a id="3922" href="Ledger.Utxo.html#3763" class="Bound">slot</a>              <a id="3940" class="Symbol">→</a>  <a id="3943" href="Ledger.Utxo.html#3751" class="Datatype">inInterval</a> <a id="3954" href="Ledger.Utxo.html#3763" class="Bound">slot</a> <a id="3959" class="Symbol">(</a><a id="3960" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3965" href="Ledger.Utxo.html#3910" class="Bound">l</a>  <a id="3968" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3970" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="3977" class="Symbol">)</a>
  <a id="inInterval.upper"></a><a id="3981" href="Ledger.Utxo.html#3981" class="InductiveConstructor">upper</a> <a id="3987" class="Symbol">:</a> <a id="3989" class="Symbol">∀</a> <a id="3991" class="Symbol">{</a><a id="3992" href="Ledger.Utxo.html#3992" class="Bound">r</a><a id="3993" class="Symbol">}</a>   <a id="3997" class="Symbol">→</a> <a id="3999" href="Ledger.Utxo.html#3763" class="Bound">slot</a> <a id="4004" href="Ledger.Epoch.html#935" class="Function Operator">≤ˢ</a> <a id="4007" href="Ledger.Utxo.html#3992" class="Bound">r</a>              <a id="4022" class="Symbol">→</a>  <a id="4025" href="Ledger.Utxo.html#3751" class="Datatype">inInterval</a> <a id="4036" href="Ledger.Utxo.html#3763" class="Bound">slot</a> <a id="4041" class="Symbol">(</a><a id="4042" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="4050" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4052" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4057" href="Ledger.Utxo.html#3992" class="Bound">r</a><a id="4058" class="Symbol">)</a>
  <a id="inInterval.none"></a><a id="4062" href="Ledger.Utxo.html#4062" class="InductiveConstructor">none</a>  <a id="4068" class="Symbol">:</a>                                     <a id="4106" href="Ledger.Utxo.html#3751" class="Datatype">inInterval</a> <a id="4117" href="Ledger.Utxo.html#3763" class="Bound">slot</a> <a id="4122" class="Symbol">(</a><a id="4123" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="4131" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4133" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="4140" class="Symbol">)</a>

<a id="4143" class="Markup">\end{code}</a><a id="4153" class="Background">
</a><a id="4154" class="Markup">\begin{code}[hide]</a>
<a id="4173" class="Keyword">instance</a>
  <a id="4184" class="Keyword">unquoteDecl</a> <a id="DecEq-DepositPurpose"></a><a id="4196" href="Ledger.Utxo.html#4196" class="Function">DecEq-DepositPurpose</a> <a id="4217" class="Symbol">=</a> <a id="4219" href="Tactic.Derive.DecEq.html#3471" class="Function">derive-DecEq</a> <a id="4232" class="Symbol">((</a><a id="4234" class="Keyword">quote</a> <a id="4240" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="4255" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4257" href="Ledger.Utxo.html#4196" class="Function">DecEq-DepositPurpose</a><a id="4277" class="Symbol">)</a> <a id="4279" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="4281" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="4283" class="Symbol">)</a>

  <a id="HasCoin-UTxO"></a><a id="4288" href="Ledger.Utxo.html#4288" class="Function">HasCoin-UTxO</a> <a id="4301" class="Symbol">:</a> <a id="4303" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="4311" href="Ledger.Transaction.html#3270" class="Function">UTxO</a>
  <a id="4318" href="Ledger.Utxo.html#4288" class="Function">HasCoin-UTxO</a> <a id="4331" class="Symbol">.</a><a id="4332" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="4340" class="Symbol">=</a> <a id="4342" href="Ledger.Utxo.html#2275" class="Function">cbalance</a>
<a id="4351" class="Markup">\end{code}</a><a id="4361" class="Background">

\caption{Functions used in UTxO rules}
\label{fig:functions:utxo}
\end{figure*}

\AgdaTarget{UTxOEnv, UTxOState, \_⊢\_⇀⦇\_,UTXO⦈\_}
\begin{figure*}[h]
\emph{Derived types}
</a><a id="4535" class="Markup">\begin{code}</a>
<a id="Deposits"></a><a id="4548" href="Ledger.Utxo.html#4548" class="Function">Deposits</a> <a id="4557" class="Symbol">=</a> <a id="4559" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="4574" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="4576" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="4581" class="Markup">\end{code}</a><a id="4591" class="Background">
\emph{UTxO environment}
</a><a id="4616" class="Markup">\begin{code}</a>
<a id="4629" class="Keyword">record</a> <a id="UTxOEnv"></a><a id="4636" href="Ledger.Utxo.html#4636" class="Record">UTxOEnv</a> <a id="4644" class="Symbol">:</a> <a id="4646" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4650" class="Keyword">where</a>
  <a id="4658" class="Keyword">field</a> <a id="UTxOEnv.slot"></a><a id="4664" href="Ledger.Utxo.html#4664" class="Field">slot</a>     <a id="4673" class="Symbol">:</a> <a id="4675" href="Ledger.Epoch.html#608" class="Function">Slot</a>
        <a id="UTxOEnv.pparams"></a><a id="4688" href="Ledger.Utxo.html#4688" class="Field">pparams</a>  <a id="4697" class="Symbol">:</a> <a id="4699" href="Ledger.PParams.html#1053" class="Record">PParams</a>
<a id="4707" class="Markup">\end{code}</a><a id="4717" class="Background">
\emph{UTxO states}
</a><a id="4737" class="Markup">\begin{code}</a>
<a id="4750" class="Keyword">record</a> <a id="UTxOState"></a><a id="4757" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="4767" class="Symbol">:</a> <a id="4769" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4773" class="Keyword">where</a>
  <a id="4781" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ᵘ"></a><a id="4793" href="Ledger.Utxo.html#4793" class="InductiveConstructor Operator">⟦_,_,_,_⟧ᵘ</a>
  <a id="4806" class="Keyword">field</a> <a id="UTxOState.utxo"></a><a id="4812" href="Ledger.Utxo.html#4812" class="Field">utxo</a>       <a id="4823" class="Symbol">:</a> <a id="4825" href="Ledger.Transaction.html#3270" class="Function">UTxO</a>
        <a id="UTxOState.fees"></a><a id="4838" href="Ledger.Utxo.html#4838" class="Field">fees</a>       <a id="4849" class="Symbol">:</a> <a id="4851" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
        <a id="UTxOState.deposits"></a><a id="4864" href="Ledger.Utxo.html#4864" class="Field">deposits</a>   <a id="4875" class="Symbol">:</a> <a id="4877" href="Ledger.Utxo.html#4548" class="Function">Deposits</a>
        <a id="UTxOState.donations"></a><a id="4894" href="Ledger.Utxo.html#4894" class="Field">donations</a>  <a id="4905" class="Symbol">:</a> <a id="4907" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="4912" class="Markup">\end{code}</a><a id="4922" class="Background">
\emph{UTxO transitions}

</a><a id="4948" class="Markup">\begin{code}[hide]</a>
<a id="⟦_⟧"></a><a id="4967" href="Ledger.Utxo.html#4967" class="Function Operator">⟦_⟧</a> <a id="4971" class="Symbol">:</a> <a id="4973" class="Symbol">{</a><a id="4974" href="Ledger.Utxo.html#4974" class="Bound">A</a> <a id="4976" class="Symbol">:</a> <a id="4978" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="4981" class="Symbol">}</a> <a id="4983" class="Symbol">→</a> <a id="4985" href="Ledger.Utxo.html#4974" class="Bound">A</a> <a id="4987" class="Symbol">→</a> <a id="4989" href="Ledger.Utxo.html#4974" class="Bound">A</a>
<a id="4991" href="Ledger.Utxo.html#4967" class="Function Operator">⟦_⟧</a> <a id="4995" class="Symbol">=</a> <a id="4997" href="Function.Base.html#695" class="Function">id</a>

<a id="5001" class="Keyword">instance</a>
  <a id="5012" href="Ledger.Utxo.html#5012" class="Function">_</a> <a id="5014" class="Symbol">=</a> <a id="5016" href="Ledger.Prelude.html#2395" class="Function">≟-∅</a>

  <a id="∈-inst"></a><a id="5023" href="Ledger.Utxo.html#5023" class="Function">∈-inst</a> <a id="5030" class="Symbol">:</a> <a id="5032" class="Symbol">∀</a> <a id="5034" class="Symbol">{</a><a id="5035" href="Ledger.Utxo.html#5035" class="Bound">A</a> <a id="5037" class="Symbol">:</a> <a id="5039" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="5042" class="Symbol">}</a> <a id="5044" class="Symbol">⦃</a> <a id="5046" href="Ledger.Utxo.html#5046" class="Bound">_</a> <a id="5048" class="Symbol">:</a> <a id="5050" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="5056" href="Ledger.Utxo.html#5035" class="Bound">A</a> <a id="5058" class="Symbol">⦄</a> <a id="5060" class="Symbol">{</a><a id="5061" href="Ledger.Utxo.html#5061" class="Bound">s</a> <a id="5063" class="Symbol">:</a> <a id="5065" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="5067" href="Ledger.Utxo.html#5035" class="Bound">A</a><a id="5068" class="Symbol">}</a> <a id="5070" class="Symbol">→</a> <a id="5072" href="Interface.Decidable.Instance.html#499" class="Record">Dec₁</a> <a id="5077" class="Symbol">(</a><a id="5078" href="Axiom.Set.html#1806" class="Function Operator">_∈</a> <a id="5081" href="Ledger.Utxo.html#5061" class="Bound">s</a><a id="5082" class="Symbol">)</a>
  <a id="5086" href="Ledger.Utxo.html#5023" class="Function">∈-inst</a> <a id="5093" class="Symbol">{</a><a id="5094" class="Argument">s</a> <a id="5096" class="Symbol">=</a> <a id="5098" href="Ledger.Utxo.html#5098" class="Bound">s</a><a id="5099" class="Symbol">}</a> <a id="5101" class="Symbol">.</a><a id="5102" href="Interface.Decidable.Instance.html#564" class="Field">Dec₁.P?</a> <a id="5110" class="Symbol">=</a> <a id="5112" href="Axiom.Set.html#10378" class="Function Operator">_∈?</a> <a id="5116" href="Ledger.Utxo.html#5098" class="Bound">s</a>

  <a id="all?&#39;"></a><a id="5121" href="Ledger.Utxo.html#5121" class="Function">all?&#39;</a> <a id="5127" class="Symbol">:</a> <a id="5129" class="Symbol">∀</a> <a id="5131" class="Symbol">{</a><a id="5132" href="Ledger.Utxo.html#5132" class="Bound">A</a> <a id="5134" class="Symbol">:</a> <a id="5136" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="5139" class="Symbol">}</a> <a id="5141" class="Symbol">{</a><a id="5142" href="Ledger.Utxo.html#5142" class="Bound">P</a> <a id="5144" class="Symbol">:</a> <a id="5146" href="Ledger.Utxo.html#5132" class="Bound">A</a> <a id="5148" class="Symbol">→</a> <a id="5150" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="5153" class="Symbol">}</a> <a id="5155" class="Symbol">⦃</a> <a id="5157" href="Ledger.Utxo.html#5157" class="Bound">P?</a> <a id="5160" class="Symbol">:</a> <a id="5162" href="Interface.Decidable.Instance.html#499" class="Record">Dec₁</a> <a id="5167" href="Ledger.Utxo.html#5142" class="Bound">P</a> <a id="5169" class="Symbol">⦄</a> <a id="5171" class="Symbol">⦃</a> <a id="5173" href="Ledger.Utxo.html#5173" class="Bound">_</a> <a id="5175" class="Symbol">:</a> <a id="5177" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="5183" href="Ledger.Utxo.html#5132" class="Bound">A</a> <a id="5185" class="Symbol">⦄</a> <a id="5187" class="Symbol">{</a><a id="5188" href="Ledger.Utxo.html#5188" class="Bound">s</a> <a id="5190" class="Symbol">:</a> <a id="5192" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="5194" href="Ledger.Utxo.html#5132" class="Bound">A</a><a id="5195" class="Symbol">}</a> <a id="5197" class="Symbol">→</a> <a id="5199" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="5203" class="Symbol">(</a><a id="5204" href="Axiom.Set.html#9486" class="Function">All</a> <a id="5208" href="Ledger.Utxo.html#5142" class="Bound">P</a> <a id="5210" href="Ledger.Utxo.html#5188" class="Bound">s</a><a id="5211" class="Symbol">)</a>
  <a id="5215" href="Ledger.Utxo.html#5121" class="Function">all?&#39;</a> <a id="5221" class="Symbol">⦃</a> <a id="5223" class="Argument">P?</a> <a id="5226" class="Symbol">=</a> <a id="5228" class="Keyword">record</a> <a id="5235" class="Symbol">{</a> <a id="5237" href="Interface.Decidable.Instance.html#564" class="Field">P?</a> <a id="5240" class="Symbol">=</a> <a id="5242" href="Ledger.Utxo.html#5242" class="Bound">P?</a> <a id="5245" class="Symbol">}</a> <a id="5247" class="Symbol">⦄</a> <a id="5249" class="Symbol">{</a><a id="5250" href="Ledger.Utxo.html#5250" class="Bound">s</a><a id="5251" class="Symbol">}</a> <a id="5253" class="Symbol">=</a> <a id="5255" href="Axiom.Set.html#10426" class="Function">all?</a> <a id="5260" href="Ledger.Utxo.html#5242" class="Bound">P?</a>

  <a id="netId?"></a><a id="5266" href="Ledger.Utxo.html#5266" class="Function">netId?</a> <a id="5273" class="Symbol">:</a> <a id="5275" class="Symbol">∀</a> <a id="5277" class="Symbol">{</a><a id="5278" href="Ledger.Utxo.html#5278" class="Bound">A</a> <a id="5280" class="Symbol">:</a> <a id="5282" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="5285" class="Symbol">}</a> <a id="5287" class="Symbol">{</a><a id="5288" href="Ledger.Utxo.html#5288" class="Bound">networkId</a> <a id="5298" class="Symbol">:</a> <a id="5300" href="Ledger.Epoch.html#337" class="Function">Network</a><a id="5307" class="Symbol">}</a> <a id="5309" class="Symbol">{</a><a id="5310" href="Ledger.Utxo.html#5310" class="Bound">f</a> <a id="5312" class="Symbol">:</a> <a id="5314" href="Ledger.Utxo.html#5278" class="Bound">A</a> <a id="5316" class="Symbol">→</a> <a id="5318" href="Ledger.Epoch.html#337" class="Function">Network</a><a id="5325" class="Symbol">}</a> <a id="5327" class="Symbol">→</a> <a id="5329" href="Interface.Decidable.Instance.html#499" class="Record">Dec₁</a> <a id="5334" class="Symbol">(λ</a> <a id="5337" href="Ledger.Utxo.html#5337" class="Bound">a</a> <a id="5339" class="Symbol">→</a> <a id="5341" href="Ledger.Utxo.html#5310" class="Bound">f</a> <a id="5343" href="Ledger.Utxo.html#5337" class="Bound">a</a> <a id="5345" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5347" href="Ledger.Utxo.html#5288" class="Bound">networkId</a><a id="5356" class="Symbol">)</a>
  <a id="5360" href="Ledger.Utxo.html#5266" class="Function">netId?</a> <a id="5367" class="Symbol">{_}</a> <a id="5371" class="Symbol">{</a><a id="5372" href="Ledger.Utxo.html#5372" class="Bound">networkId</a><a id="5381" class="Symbol">}</a> <a id="5383" class="Symbol">{</a><a id="5384" href="Ledger.Utxo.html#5384" class="Bound">f</a><a id="5385" class="Symbol">}</a> <a id="5387" class="Symbol">.</a><a id="5388" href="Interface.Decidable.Instance.html#564" class="Field">Dec₁.P?</a> <a id="5396" href="Ledger.Utxo.html#5396" class="Bound">a</a> <a id="5398" class="Symbol">=</a> <a id="5400" href="Ledger.Utxo.html#5384" class="Bound">f</a> <a id="5402" href="Ledger.Utxo.html#5396" class="Bound">a</a> <a id="5404" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="5406" href="Ledger.Utxo.html#5372" class="Bound">networkId</a>

  <a id="Dec-inInterval"></a><a id="5419" href="Ledger.Utxo.html#5419" class="Function">Dec-inInterval</a> <a id="5434" class="Symbol">:</a> <a id="5436" class="Symbol">{</a><a id="5437" href="Ledger.Utxo.html#5437" class="Bound">slot</a> <a id="5442" class="Symbol">:</a> <a id="5444" href="Ledger.Epoch.html#608" class="Function">Slot</a><a id="5448" class="Symbol">}</a> <a id="5450" class="Symbol">{</a><a id="5451" href="Ledger.Utxo.html#5451" class="Bound">I</a> <a id="5453" class="Symbol">:</a> <a id="5455" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5461" href="Ledger.Epoch.html#608" class="Function">Slot</a> <a id="5466" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5468" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5474" href="Ledger.Epoch.html#608" class="Function">Slot</a><a id="5478" class="Symbol">}</a> <a id="5480" class="Symbol">→</a> <a id="5482" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="5486" class="Symbol">(</a><a id="5487" href="Ledger.Utxo.html#3751" class="Datatype">inInterval</a> <a id="5498" href="Ledger.Utxo.html#5437" class="Bound">slot</a> <a id="5503" href="Ledger.Utxo.html#5451" class="Bound">I</a><a id="5504" class="Symbol">)</a>
  <a id="5508" href="Ledger.Utxo.html#5419" class="Function">Dec-inInterval</a> <a id="5523" class="Symbol">{</a><a id="5524" href="Ledger.Utxo.html#5524" class="Bound">slot</a><a id="5528" class="Symbol">}</a> <a id="5530" class="Symbol">{</a><a id="5531" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5536" href="Ledger.Utxo.html#5536" class="Bound">x</a>  <a id="5539" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5541" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5546" href="Ledger.Utxo.html#5546" class="Bound">y</a> <a id="5548" class="Symbol">}</a> <a id="5550" class="Keyword">with</a> <a id="5555" href="Ledger.Utxo.html#5536" class="Bound">x</a> <a id="5557" href="Ledger.Epoch.html#1059" class="Function Operator">≤ˢ?</a> <a id="5561" href="Ledger.Utxo.html#5524" class="Bound">slot</a> <a id="5566" class="Symbol">|</a> <a id="5568" href="Ledger.Utxo.html#5524" class="Bound">slot</a> <a id="5573" href="Ledger.Epoch.html#1059" class="Function Operator">≤ˢ?</a> <a id="5577" href="Ledger.Utxo.html#5546" class="Bound">y</a>
  <a id="5581" class="Symbol">...</a> <a id="5585" class="Symbol">|</a> <a id="5587" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5590" href="Ledger.Utxo.html#5590" class="Bound">¬p₁</a> <a id="5594" class="Symbol">|</a> <a id="5596" class="Symbol">_</a>      <a id="5603" class="Symbol">=</a> <a id="5605" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5608" class="Symbol">λ</a> <a id="5610" class="Keyword">where</a> <a id="5616" class="Symbol">(</a><a id="5617" href="Ledger.Utxo.html#3818" class="InductiveConstructor">both</a> <a id="5622" class="Symbol">(</a><a id="5623" href="Ledger.Utxo.html#5623" class="Bound">h₁</a> <a id="5626" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5628" href="Ledger.Utxo.html#5628" class="Bound">h₂</a><a id="5630" class="Symbol">))</a> <a id="5633" class="Symbol">→</a> <a id="5635" href="Ledger.Utxo.html#5590" class="Bound">¬p₁</a> <a id="5639" href="Ledger.Utxo.html#5623" class="Bound">h₁</a>
  <a id="5644" class="Symbol">...</a> <a id="5648" class="Symbol">|</a> <a id="5650" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5654" href="Ledger.Utxo.html#5654" class="Bound">p₁</a> <a id="5657" class="Symbol">|</a> <a id="5659" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5662" href="Ledger.Utxo.html#5662" class="Bound">¬p₂</a> <a id="5666" class="Symbol">=</a> <a id="5668" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5671" class="Symbol">λ</a> <a id="5673" class="Keyword">where</a> <a id="5679" class="Symbol">(</a><a id="5680" href="Ledger.Utxo.html#3818" class="InductiveConstructor">both</a> <a id="5685" class="Symbol">(</a><a id="5686" href="Ledger.Utxo.html#5686" class="Bound">h₁</a> <a id="5689" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5691" href="Ledger.Utxo.html#5691" class="Bound">h₂</a><a id="5693" class="Symbol">))</a> <a id="5696" class="Symbol">→</a> <a id="5698" href="Ledger.Utxo.html#5662" class="Bound">¬p₂</a> <a id="5702" href="Ledger.Utxo.html#5691" class="Bound">h₂</a>
  <a id="5707" class="Symbol">...</a> <a id="5711" class="Symbol">|</a> <a id="5713" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5717" href="Ledger.Utxo.html#5717" class="Bound">p₁</a> <a id="5720" class="Symbol">|</a> <a id="5722" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5726" href="Ledger.Utxo.html#5726" class="Bound">p₂</a> <a id="5729" class="Symbol">=</a> <a id="5731" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5735" class="Symbol">(</a><a id="5736" href="Ledger.Utxo.html#3818" class="InductiveConstructor">both</a> <a id="5741" class="Symbol">(</a><a id="5742" href="Ledger.Utxo.html#5717" class="Bound">p₁</a> <a id="5745" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5747" href="Ledger.Utxo.html#5726" class="Bound">p₂</a><a id="5749" class="Symbol">))</a>
  <a id="5754" href="Ledger.Utxo.html#5419" class="Function">Dec-inInterval</a> <a id="5769" class="Symbol">{</a><a id="5770" href="Ledger.Utxo.html#5770" class="Bound">slot</a><a id="5774" class="Symbol">}</a> <a id="5776" class="Symbol">{</a><a id="5777" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5782" href="Ledger.Utxo.html#5782" class="Bound">x</a>  <a id="5785" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5787" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="5794" class="Symbol">}</a> <a id="5796" class="Keyword">with</a> <a id="5801" href="Ledger.Utxo.html#5782" class="Bound">x</a> <a id="5803" href="Ledger.Epoch.html#1059" class="Function Operator">≤ˢ?</a> <a id="5807" href="Ledger.Utxo.html#5770" class="Bound">slot</a>
  <a id="5814" class="Symbol">...</a> <a id="5818" class="Symbol">|</a> <a id="5820" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5823" href="Ledger.Utxo.html#5823" class="Bound">¬p</a> <a id="5826" class="Symbol">=</a> <a id="5828" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a>  <a id="5832" class="Symbol">(λ</a> <a id="5835" class="Keyword">where</a> <a id="5841" class="Symbol">(</a><a id="5842" href="Ledger.Utxo.html#3899" class="InductiveConstructor">lower</a> <a id="5848" href="Ledger.Utxo.html#5848" class="Bound">h</a><a id="5849" class="Symbol">)</a> <a id="5851" class="Symbol">→</a> <a id="5853" href="Ledger.Utxo.html#5823" class="Bound">¬p</a> <a id="5856" href="Ledger.Utxo.html#5848" class="Bound">h</a><a id="5857" class="Symbol">)</a>
  <a id="5861" class="Symbol">...</a> <a id="5865" class="Symbol">|</a> <a id="5867" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5871" href="Ledger.Utxo.html#5871" class="Bound">p</a> <a id="5873" class="Symbol">=</a> <a id="5875" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5879" class="Symbol">(</a><a id="5880" href="Ledger.Utxo.html#3899" class="InductiveConstructor">lower</a> <a id="5886" href="Ledger.Utxo.html#5871" class="Bound">p</a><a id="5887" class="Symbol">)</a>
  <a id="5891" href="Ledger.Utxo.html#5419" class="Function">Dec-inInterval</a> <a id="5906" class="Symbol">{</a><a id="5907" href="Ledger.Utxo.html#5907" class="Bound">slot</a><a id="5911" class="Symbol">}</a> <a id="5913" class="Symbol">{</a><a id="5914" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="5922" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5924" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5929" href="Ledger.Utxo.html#5929" class="Bound">x</a> <a id="5931" class="Symbol">}</a> <a id="5933" class="Keyword">with</a> <a id="5938" href="Ledger.Utxo.html#5907" class="Bound">slot</a> <a id="5943" href="Ledger.Epoch.html#1059" class="Function Operator">≤ˢ?</a> <a id="5947" href="Ledger.Utxo.html#5929" class="Bound">x</a>
  <a id="5951" class="Symbol">...</a> <a id="5955" class="Symbol">|</a> <a id="5957" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5960" href="Ledger.Utxo.html#5960" class="Bound">¬p</a> <a id="5963" class="Symbol">=</a> <a id="5965" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a>  <a id="5969" class="Symbol">(λ</a> <a id="5972" class="Keyword">where</a> <a id="5978" class="Symbol">(</a><a id="5979" href="Ledger.Utxo.html#3981" class="InductiveConstructor">upper</a> <a id="5985" href="Ledger.Utxo.html#5985" class="Bound">h</a><a id="5986" class="Symbol">)</a> <a id="5988" class="Symbol">→</a> <a id="5990" href="Ledger.Utxo.html#5960" class="Bound">¬p</a> <a id="5993" href="Ledger.Utxo.html#5985" class="Bound">h</a><a id="5994" class="Symbol">)</a>
  <a id="5998" class="Symbol">...</a> <a id="6002" class="Symbol">|</a> <a id="6004" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="6008" href="Ledger.Utxo.html#6008" class="Bound">p</a> <a id="6010" class="Symbol">=</a> <a id="6012" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="6016" class="Symbol">(</a><a id="6017" href="Ledger.Utxo.html#3981" class="InductiveConstructor">upper</a> <a id="6023" href="Ledger.Utxo.html#6008" class="Bound">p</a><a id="6024" class="Symbol">)</a>
  <a id="6028" href="Ledger.Utxo.html#5419" class="Function">Dec-inInterval</a> <a id="6043" class="Symbol">{</a><a id="6044" href="Ledger.Utxo.html#6044" class="Bound">slot</a><a id="6048" class="Symbol">}</a> <a id="6050" class="Symbol">{</a><a id="6051" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="6059" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6061" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="6068" class="Symbol">}</a> <a id="6070" class="Symbol">=</a> <a id="6072" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="6076" href="Ledger.Utxo.html#4062" class="InductiveConstructor">none</a>

  <a id="HasCoin-UTxOState"></a><a id="6084" href="Ledger.Utxo.html#6084" class="Function">HasCoin-UTxOState</a> <a id="6102" class="Symbol">:</a> <a id="6104" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="6112" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a>
  <a id="6124" href="Ledger.Utxo.html#6084" class="Function">HasCoin-UTxOState</a> <a id="6142" class="Symbol">.</a><a id="6143" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="6151" href="Ledger.Utxo.html#6151" class="Bound">s</a> <a id="6153" class="Symbol">=</a> <a id="6155" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="6163" class="Symbol">(</a><a id="6164" href="Ledger.Utxo.html#4812" class="Field">UTxOState.utxo</a> <a id="6179" href="Ledger.Utxo.html#6151" class="Bound">s</a><a id="6180" class="Symbol">)</a> <a id="6182" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6184" class="Symbol">(</a><a id="6185" href="Ledger.Utxo.html#4838" class="Field">UTxOState.fees</a> <a id="6200" href="Ledger.Utxo.html#6151" class="Bound">s</a><a id="6201" class="Symbol">)</a> <a id="6203" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6205" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="6213" class="Symbol">(</a><a id="6214" href="Ledger.Utxo.html#4864" class="Field">UTxOState.deposits</a> <a id="6233" href="Ledger.Utxo.html#6151" class="Bound">s</a><a id="6234" class="Symbol">)</a> <a id="6236" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6238" href="Ledger.Utxo.html#4894" class="Field">UTxOState.donations</a> <a id="6258" href="Ledger.Utxo.html#6151" class="Bound">s</a>
<a id="6260" class="Keyword">data</a>
<a id="6265" class="Markup">\end{code}</a><a id="6275" class="Background">
</a><a id="6276" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXO⦈_"></a><a id="6291" href="Ledger.Utxo.html#6291" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a> <a id="6305" class="Symbol">:</a> <a id="6307" href="Ledger.Utxo.html#4636" class="Record">UTxOEnv</a> <a id="6315" class="Symbol">→</a> <a id="6317" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="6327" class="Symbol">→</a> <a id="6329" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="6336" class="Symbol">→</a> <a id="6338" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="6348" class="Symbol">→</a> <a id="6350" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="6354" class="Markup">\end{code}</a><a id="6364" class="Background">
\caption{UTxO transition-system types}
\label{fig:ts-types:utxo-shelley}
\end{figure*}

\begin{figure*}
</a><a id="6469" class="Markup">\begin{code}</a>
<a id="updateCertDeposits"></a><a id="6482" href="Ledger.Utxo.html#6482" class="Function">updateCertDeposits</a> <a id="6501" class="Symbol">:</a> <a id="6503" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="6511" class="Symbol">→</a> <a id="6513" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="6518" href="Ledger.Deleg.html#832" class="Datatype">DCert</a> <a id="6524" class="Symbol">→</a> <a id="6526" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="6541" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="6543" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="6548" class="Symbol">→</a> <a id="6550" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="6565" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="6567" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="6572" href="Ledger.Utxo.html#6482" class="Function">updateCertDeposits</a> <a id="6591" class="Symbol">_</a>  <a id="6594" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>              <a id="6610" href="Ledger.Utxo.html#6610" class="Bound">deposits</a> <a id="6619" class="Symbol">=</a> <a id="6621" href="Ledger.Utxo.html#6610" class="Bound">deposits</a>
<a id="6630" href="Ledger.Utxo.html#6482" class="Function">updateCertDeposits</a> <a id="6649" href="Ledger.Utxo.html#6649" class="Bound">pp</a> <a id="6652" class="Symbol">(</a><a id="6653" href="Ledger.Utxo.html#6653" class="Bound">cert</a> <a id="6658" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6660" href="Ledger.Utxo.html#6660" class="Bound">certs</a><a id="6665" class="Symbol">)</a>  <a id="6668" href="Ledger.Utxo.html#6668" class="Bound">deposits</a> <a id="6677" class="Symbol">=</a>
  <a id="6681" class="Symbol">((</a><a id="6683" href="Ledger.Utxo.html#6482" class="Function">updateCertDeposits</a> <a id="6702" href="Ledger.Utxo.html#6649" class="Bound">pp</a> <a id="6705" href="Ledger.Utxo.html#6660" class="Bound">certs</a> <a id="6711" href="Ledger.Utxo.html#6668" class="Bound">deposits</a><a id="6719" class="Symbol">)</a> <a id="6721" href="Axiom.Set.Map.Dec.html#1962" class="Function Operator">∪⁺</a> <a id="6724" href="Ledger.Utxo.html#3004" class="Function">certDepositᵐ</a> <a id="6737" href="Ledger.Utxo.html#6649" class="Bound">pp</a> <a id="6740" href="Ledger.Utxo.html#6653" class="Bound">cert</a><a id="6744" class="Symbol">)</a> <a id="6746" href="Axiom.Set.Map.html#8482" class="Function Operator">∣</a> <a id="6748" href="Ledger.Utxo.html#3413" class="Function">certRefundˢ</a> <a id="6760" href="Ledger.Utxo.html#6653" class="Bound">cert</a> <a id="6765" href="Axiom.Set.Map.html#8482" class="Function Operator">ᶜ</a>

<a id="updateProposalDeposits"></a><a id="6768" href="Ledger.Utxo.html#6768" class="Function">updateProposalDeposits</a> <a id="6791" class="Symbol">:</a> <a id="6793" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="6801" class="Symbol">→</a> <a id="6803" href="Ledger.Transaction.html#1454" class="Field">TxId</a> <a id="6808" class="Symbol">→</a> <a id="6810" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="6815" href="Ledger.GovernanceActions.html#9288" class="Record">GovProposal</a> <a id="6827" class="Symbol">→</a> <a id="6829" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="6844" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="6846" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="6851" class="Symbol">→</a> <a id="6853" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="6868" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="6870" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="6875" href="Ledger.Utxo.html#6768" class="Function">updateProposalDeposits</a> <a id="6898" href="Ledger.Utxo.html#6898" class="Bound">pp</a> <a id="6901" class="Symbol">_</a>    <a id="6906" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>             <a id="6921" href="Ledger.Utxo.html#6921" class="Bound">deposits</a> <a id="6930" class="Symbol">=</a> <a id="6932" href="Ledger.Utxo.html#6921" class="Bound">deposits</a>
<a id="6941" href="Ledger.Utxo.html#6768" class="Function">updateProposalDeposits</a> <a id="6964" href="Ledger.Utxo.html#6964" class="Bound">pp</a> <a id="6967" href="Ledger.Utxo.html#6967" class="Bound">txid</a> <a id="6972" class="Symbol">(</a><a id="6973" href="Ledger.Utxo.html#6973" class="Bound">prop</a> <a id="6978" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6980" href="Ledger.Utxo.html#6980" class="Bound">props</a><a id="6985" class="Symbol">)</a> <a id="6987" href="Ledger.Utxo.html#6987" class="Bound">deposits</a> <a id="6996" class="Symbol">=</a>
  <a id="7000" href="Ledger.Utxo.html#6768" class="Function">updateProposalDeposits</a> <a id="7023" href="Ledger.Utxo.html#6964" class="Bound">pp</a> <a id="7026" href="Ledger.Utxo.html#6967" class="Bound">txid</a> <a id="7031" href="Ledger.Utxo.html#6980" class="Bound">props</a> <a id="7037" href="Ledger.Utxo.html#6987" class="Bound">deposits</a> <a id="7046" href="Axiom.Set.Map.Dec.html#1962" class="Function Operator">∪⁺</a> <a id="7049" href="Ledger.Utxo.html#3491" class="Function">propDepositᵐ</a> <a id="7062" href="Ledger.Utxo.html#6964" class="Bound">pp</a> <a id="7065" class="Symbol">(</a><a id="7066" href="Ledger.Utxo.html#6967" class="Bound">txid</a> <a id="7071" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="7073" href="Data.List.Base.html#5058" class="Function">length</a> <a id="7080" href="Ledger.Utxo.html#6980" class="Bound">props</a><a id="7085" class="Symbol">)</a> <a id="7087" href="Ledger.Utxo.html#6973" class="Bound">prop</a>

<a id="updateDeposits"></a><a id="7093" href="Ledger.Utxo.html#7093" class="Function">updateDeposits</a> <a id="7108" class="Symbol">:</a> <a id="7110" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="7118" class="Symbol">→</a> <a id="7120" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="7127" class="Symbol">→</a> <a id="7129" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="7144" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="7146" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="7151" class="Symbol">→</a> <a id="7153" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="7168" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="7170" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="7175" href="Ledger.Utxo.html#7093" class="Function">updateDeposits</a> <a id="7190" href="Ledger.Utxo.html#7190" class="Bound">pp</a> <a id="7193" href="Ledger.Utxo.html#7193" class="Bound">txb</a> <a id="7197" class="Symbol">=</a> <a id="7199" href="Ledger.Utxo.html#6482" class="Function">updateCertDeposits</a> <a id="7218" href="Ledger.Utxo.html#7190" class="Bound">pp</a> <a id="7221" class="Symbol">(</a><a id="7222" href="Ledger.Transaction.html#3842" class="Field">txcerts</a> <a id="7230" href="Ledger.Utxo.html#7193" class="Bound">txb</a><a id="7233" class="Symbol">)</a>
                      <a id="7257" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="7259" href="Ledger.Utxo.html#6768" class="Function">updateProposalDeposits</a> <a id="7282" href="Ledger.Utxo.html#7190" class="Bound">pp</a> <a id="7285" class="Symbol">(</a><a id="7286" href="Ledger.Transaction.html#4148" class="Field">txid</a> <a id="7291" href="Ledger.Utxo.html#7193" class="Bound">txb</a><a id="7294" class="Symbol">)</a> <a id="7296" class="Symbol">(</a><a id="7297" href="Ledger.Transaction.html#3943" class="Field">txprop</a> <a id="7304" href="Ledger.Utxo.html#7193" class="Bound">txb</a><a id="7307" class="Symbol">)</a>

<a id="depositsChange"></a><a id="7310" href="Ledger.Utxo.html#7310" class="Function">depositsChange</a> <a id="7325" class="Symbol">:</a> <a id="7327" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="7335" class="Symbol">→</a> <a id="7337" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="7344" class="Symbol">→</a> <a id="7346" href="Ledger.Utxo.html#2431" class="Datatype">DepositPurpose</a> <a id="7361" href="Ledger.Prelude.html#2585" class="Function Operator">⇀</a> <a id="7363" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="7368" class="Symbol">→</a> <a id="7370" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a>
<a id="7372" href="Ledger.Utxo.html#7310" class="Function">depositsChange</a> <a id="7387" href="Ledger.Utxo.html#7387" class="Bound">pp</a> <a id="7390" href="Ledger.Utxo.html#7390" class="Bound">txb</a> <a id="7394" href="Ledger.Utxo.html#7394" class="Bound">deposits</a> <a id="7403" class="Symbol">=</a> <a id="7405" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="7413" class="Symbol">(</a><a id="7414" href="Ledger.Utxo.html#7093" class="Function">updateDeposits</a> <a id="7429" href="Ledger.Utxo.html#7387" class="Bound">pp</a> <a id="7432" href="Ledger.Utxo.html#7390" class="Bound">txb</a> <a id="7436" href="Ledger.Utxo.html#7394" class="Bound">deposits</a><a id="7444" class="Symbol">)</a> <a id="7446" href="Data.Integer.Base.html#4899" class="Function Operator">⊖</a> <a id="7448" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="7456" href="Ledger.Utxo.html#7394" class="Bound">deposits</a>

<a id="depositRefunds"></a><a id="7466" href="Ledger.Utxo.html#7466" class="Function">depositRefunds</a> <a id="7481" class="Symbol">:</a> <a id="7483" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="7491" class="Symbol">→</a> <a id="7493" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="7503" class="Symbol">→</a> <a id="7505" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="7512" class="Symbol">→</a> <a id="7514" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="7519" href="Ledger.Utxo.html#7466" class="Function">depositRefunds</a> <a id="7534" href="Ledger.Utxo.html#7534" class="Bound">pp</a> <a id="7537" href="Ledger.Utxo.html#7537" class="Bound">st</a> <a id="7540" href="Ledger.Utxo.html#7540" class="Bound">txb</a> <a id="7544" class="Symbol">=</a> <a id="7546" href="Data.Integer.Ext.html#300" class="Function">negPart</a> <a id="7554" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7556" href="Ledger.Utxo.html#7310" class="Function">depositsChange</a> <a id="7571" href="Ledger.Utxo.html#7534" class="Bound">pp</a> <a id="7574" href="Ledger.Utxo.html#7540" class="Bound">txb</a> <a id="7578" href="Ledger.Utxo.html#4864" class="Function">deposits</a>
  <a id="7589" class="Keyword">where</a> <a id="7595" class="Keyword">open</a> <a id="7600" href="Ledger.Utxo.html#4757" class="Module">UTxOState</a> <a id="7610" href="Ledger.Utxo.html#7537" class="Bound">st</a>

<a id="newDeposits"></a><a id="7614" href="Ledger.Utxo.html#7614" class="Function">newDeposits</a> <a id="7626" class="Symbol">:</a> <a id="7628" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="7636" class="Symbol">→</a> <a id="7638" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="7648" class="Symbol">→</a> <a id="7650" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="7657" class="Symbol">→</a> <a id="7659" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="7664" href="Ledger.Utxo.html#7614" class="Function">newDeposits</a> <a id="7676" href="Ledger.Utxo.html#7676" class="Bound">pp</a> <a id="7679" href="Ledger.Utxo.html#7679" class="Bound">st</a> <a id="7682" href="Ledger.Utxo.html#7682" class="Bound">txb</a> <a id="7686" class="Symbol">=</a> <a id="7688" href="Data.Integer.Ext.html#209" class="Function">posPart</a> <a id="7696" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7698" href="Ledger.Utxo.html#7310" class="Function">depositsChange</a> <a id="7713" href="Ledger.Utxo.html#7676" class="Bound">pp</a> <a id="7716" href="Ledger.Utxo.html#7682" class="Bound">txb</a> <a id="7720" href="Ledger.Utxo.html#4864" class="Function">deposits</a>
  <a id="7731" class="Keyword">where</a> <a id="7737" class="Keyword">open</a> <a id="7742" href="Ledger.Utxo.html#4757" class="Module">UTxOState</a> <a id="7752" href="Ledger.Utxo.html#7679" class="Bound">st</a>

<a id="consumed"></a><a id="7756" href="Ledger.Utxo.html#7756" class="Function">consumed</a> <a id="7765" class="Symbol">:</a> <a id="7767" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="7775" class="Symbol">→</a> <a id="7777" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="7787" class="Symbol">→</a> <a id="7789" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="7796" class="Symbol">→</a> <a id="7798" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
<a id="7804" href="Ledger.Utxo.html#7756" class="Function">consumed</a> <a id="7813" href="Ledger.Utxo.html#7813" class="Bound">pp</a> <a id="7816" href="Ledger.Utxo.html#7816" class="Bound">st</a> <a id="7819" href="Ledger.Utxo.html#7819" class="Bound">txb</a> <a id="7823" class="Symbol">=</a> <a id="7825" href="Ledger.Utxo.html#2206" class="Function">balance</a> <a id="7833" class="Symbol">(</a><a id="7834" href="Ledger.Utxo.html#4812" class="Field">UTxOState.utxo</a> <a id="7849" href="Ledger.Utxo.html#7816" class="Bound">st</a> <a id="7852" href="Axiom.Set.Map.html#8412" class="Function Operator">∣</a> <a id="7854" href="Ledger.Transaction.html#3669" class="Field">txins</a> <a id="7860" href="Ledger.Utxo.html#7819" class="Bound">txb</a><a id="7863" class="Symbol">)</a>
                   <a id="7884" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="7886" href="Ledger.Transaction.html#3764" class="Field">mint</a> <a id="7891" href="Ledger.Utxo.html#7819" class="Bound">txb</a>
                   <a id="7914" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="7916" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="7923" class="Symbol">(</a><a id="7924" href="Ledger.Utxo.html#7466" class="Function">depositRefunds</a> <a id="7939" href="Ledger.Utxo.html#7813" class="Bound">pp</a> <a id="7942" href="Ledger.Utxo.html#7816" class="Bound">st</a> <a id="7945" href="Ledger.Utxo.html#7819" class="Bound">txb</a><a id="7948" class="Symbol">)</a>

<a id="produced"></a><a id="7951" href="Ledger.Utxo.html#7951" class="Function">produced</a> <a id="7960" class="Symbol">:</a> <a id="7962" href="Ledger.PParams.html#1053" class="Record">PParams</a> <a id="7970" class="Symbol">→</a> <a id="7972" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="7982" class="Symbol">→</a> <a id="7984" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="7991" class="Symbol">→</a> <a id="7993" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
<a id="7999" href="Ledger.Utxo.html#7951" class="Function">produced</a> <a id="8008" href="Ledger.Utxo.html#8008" class="Bound">pp</a> <a id="8011" href="Ledger.Utxo.html#8011" class="Bound">st</a> <a id="8014" href="Ledger.Utxo.html#8014" class="Bound">txb</a> <a id="8018" class="Symbol">=</a> <a id="8020" href="Ledger.Utxo.html#2206" class="Function">balance</a> <a id="8028" class="Symbol">(</a><a id="8029" href="Ledger.Utxo.html#2117" class="Function">outs</a> <a id="8034" href="Ledger.Utxo.html#8014" class="Bound">txb</a><a id="8037" class="Symbol">)</a>
                   <a id="8058" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="8060" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="8067" class="Symbol">(</a><a id="8068" href="Ledger.Transaction.html#3735" class="Field">txfee</a> <a id="8074" href="Ledger.Utxo.html#8014" class="Bound">txb</a><a id="8077" class="Symbol">)</a>
                   <a id="8098" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="8100" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="8107" class="Symbol">(</a><a id="8108" href="Ledger.Utxo.html#7614" class="Function">newDeposits</a> <a id="8120" href="Ledger.Utxo.html#8008" class="Bound">pp</a> <a id="8123" href="Ledger.Utxo.html#8011" class="Bound">st</a> <a id="8126" href="Ledger.Utxo.html#8014" class="Bound">txb</a><a id="8129" class="Symbol">)</a>
                   <a id="8150" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="8152" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="8159" class="Symbol">(</a><a id="8160" href="Ledger.Transaction.html#3984" class="Field">txdonation</a> <a id="8171" href="Ledger.Utxo.html#8014" class="Bound">txb</a><a id="8174" class="Symbol">)</a>

<a id="8177" class="Markup">\end{code}</a><a id="8187" class="Background">
\caption{Functions used in UTxO rules, continued}
\label{fig:functions:utxo-2}
\end{figure*}

\begin{figure*}[h]
</a><a id="8301" class="Markup">\begin{code}[hide]</a>
<a id="8320" class="Keyword">open</a> <a id="8325" href="Ledger.PParams.html#1053" class="Module">PParams</a>

<a id="8334" class="Keyword">data</a> <a id="8339" href="Ledger.Utxo.html#6291" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a> <a id="8353" class="Keyword">where</a>
<a id="8359" class="Markup">\end{code}</a><a id="8369" class="Background">
</a><a id="8370" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXO⦈_.UTXO-inductive"></a><a id="8385" href="Ledger.Utxo.html#8385" class="InductiveConstructor">UTXO-inductive</a> <a id="8400" class="Symbol">:</a>
    <a id="8406" class="Symbol">∀</a> <a id="8408" class="Symbol">{</a><a id="8409" href="Ledger.Utxo.html#8409" class="Bound">Γ</a><a id="8410" class="Symbol">}</a> <a id="8412" class="Symbol">{</a><a id="8413" href="Ledger.Utxo.html#8413" class="Bound">s</a><a id="8414" class="Symbol">}</a> <a id="8416" class="Symbol">{</a><a id="8417" href="Ledger.Utxo.html#8417" class="Bound">tx</a><a id="8419" class="Symbol">}</a>
    <a id="8425" class="Symbol">→</a> <a id="8427" class="Keyword">let</a> <a id="8431" href="Ledger.Utxo.html#8431" class="Bound">slot</a>          <a id="8445" class="Symbol">=</a> <a id="8447" href="Ledger.Utxo.html#4664" class="Field">UTxOEnv.slot</a> <a id="8460" href="Ledger.Utxo.html#8409" class="Bound">Γ</a>
          <a id="8472" href="Ledger.Utxo.html#8472" class="Bound">pp</a>            <a id="8486" class="Symbol">=</a> <a id="8488" href="Ledger.Utxo.html#4688" class="Field">UTxOEnv.pparams</a> <a id="8504" href="Ledger.Utxo.html#8409" class="Bound">Γ</a>
          <a id="8516" href="Ledger.Utxo.html#8516" class="Bound">utxo</a>          <a id="8530" class="Symbol">=</a> <a id="8532" href="Ledger.Utxo.html#4812" class="Field">UTxOState.utxo</a> <a id="8547" href="Ledger.Utxo.html#8413" class="Bound">s</a>
          <a id="8559" href="Ledger.Utxo.html#8559" class="Bound">fees</a>          <a id="8573" class="Symbol">=</a> <a id="8575" href="Ledger.Utxo.html#4838" class="Field">UTxOState.fees</a> <a id="8590" href="Ledger.Utxo.html#8413" class="Bound">s</a>
          <a id="8602" href="Ledger.Utxo.html#8602" class="Bound">deposits</a>      <a id="8616" class="Symbol">=</a> <a id="8618" href="Ledger.Utxo.html#4864" class="Field">UTxOState.deposits</a> <a id="8637" href="Ledger.Utxo.html#8413" class="Bound">s</a>
          <a id="8649" href="Ledger.Utxo.html#8649" class="Bound">donations</a>     <a id="8663" class="Symbol">=</a> <a id="8665" href="Ledger.Utxo.html#4894" class="Field">UTxOState.donations</a> <a id="8685" href="Ledger.Utxo.html#8413" class="Bound">s</a>
      <a id="8693" class="Keyword">in</a>
    <a id="8700" href="Ledger.Transaction.html#3669" class="Field">txins</a> <a id="8706" href="Ledger.Utxo.html#8417" class="Bound">tx</a> <a id="8709" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="8711" href="Axiom.Set.html#5821" class="Function">∅</a>                           <a id="8739" class="Symbol">→</a> <a id="8741" href="Ledger.Transaction.html#3669" class="Field">txins</a> <a id="8747" href="Ledger.Utxo.html#8417" class="Bound">tx</a> <a id="8750" href="Axiom.Set.html#1889" class="Function Operator">⊆</a> <a id="8752" href="Axiom.Set.Rel.html#1551" class="Function">dom</a> <a id="8756" class="Symbol">(</a><a id="8757" href="Ledger.Utxo.html#8516" class="Bound">utxo</a> <a id="8762" href="Axiom.Set.Map.html#2261" class="Function Operator">ˢ</a><a id="8763" class="Symbol">)</a>
    <a id="8769" class="Symbol">→</a> <a id="8771" href="Ledger.Utxo.html#3751" class="Datatype">inInterval</a> <a id="8782" href="Ledger.Utxo.html#8431" class="Bound">slot</a> <a id="8787" class="Symbol">(</a><a id="8788" href="Ledger.Transaction.html#3794" class="Field">txvldt</a> <a id="8795" href="Ledger.Utxo.html#8417" class="Bound">tx</a><a id="8797" class="Symbol">)</a>          <a id="8808" class="Symbol">→</a> <a id="8810" href="Ledger.Utxo.html#2335" class="Function">minfee</a> <a id="8817" href="Ledger.Utxo.html#8472" class="Bound">pp</a> <a id="8820" href="Ledger.Utxo.html#8417" class="Bound">tx</a> <a id="8823" href="Data.Nat.Base.html#1535" class="Datatype Operator">≤</a> <a id="8825" href="Ledger.Transaction.html#3735" class="Field">txfee</a> <a id="8831" href="Ledger.Utxo.html#8417" class="Bound">tx</a>
    <a id="8838" class="Symbol">→</a> <a id="8840" href="Ledger.Utxo.html#7756" class="Function">consumed</a> <a id="8849" href="Ledger.Utxo.html#8472" class="Bound">pp</a> <a id="8852" href="Ledger.Utxo.html#8413" class="Bound">s</a> <a id="8854" href="Ledger.Utxo.html#8417" class="Bound">tx</a> <a id="8857" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="8859" href="Ledger.Utxo.html#7951" class="Function">produced</a> <a id="8868" href="Ledger.Utxo.html#8472" class="Bound">pp</a> <a id="8871" href="Ledger.Utxo.html#8413" class="Bound">s</a> <a id="8873" href="Ledger.Utxo.html#8417" class="Bound">tx</a>  <a id="8877" class="Symbol">→</a> <a id="8879" href="Ledger.TokenAlgebra.html#924" class="Function">coin</a> <a id="8884" class="Symbol">(</a><a id="8885" href="Ledger.Transaction.html#3764" class="Field">mint</a> <a id="8890" href="Ledger.Utxo.html#8417" class="Bound">tx</a><a id="8892" class="Symbol">)</a> <a id="8894" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="8896" class="Number">0</a>
    <a id="8902" class="Symbol">→</a> <a id="8904" href="Ledger.Transaction.html#4122" class="Field">txsize</a> <a id="8911" href="Ledger.Utxo.html#8417" class="Bound">tx</a> <a id="8914" href="Data.Nat.Base.html#1535" class="Datatype Operator">≤</a> <a id="8916" href="Ledger.PParams.html#1233" class="Field">maxTxSize</a> <a id="8926" href="Ledger.Utxo.html#8472" class="Bound">pp</a>
    <a id="8933" href="Interface.STS.html#211" class="Function Operator">────────────────────────────────</a>
    <a id="8970" href="Ledger.Utxo.html#8409" class="Bound">Γ</a> <a id="8972" href="Ledger.Utxo.html#6291" class="Datatype Operator">⊢</a> <a id="8974" href="Ledger.Utxo.html#8413" class="Bound">s</a> <a id="8976" href="Ledger.Utxo.html#6291" class="Datatype Operator">⇀⦇</a> <a id="8979" href="Ledger.Utxo.html#8417" class="Bound">tx</a> <a id="8982" href="Ledger.Utxo.html#6291" class="Datatype Operator">,UTXO⦈</a>  <a id="8990" href="Ledger.Utxo.html#4793" class="InductiveConstructor Operator">⟦</a> <a id="8992" class="Symbol">(</a><a id="8993" href="Ledger.Utxo.html#8516" class="Bound">utxo</a> <a id="8998" href="Axiom.Set.Map.html#8482" class="Function Operator">∣</a> <a id="9000" href="Ledger.Transaction.html#3669" class="Field">txins</a> <a id="9006" href="Ledger.Utxo.html#8417" class="Bound">tx</a> <a id="9009" href="Axiom.Set.Map.html#8482" class="Function Operator">ᶜ</a><a id="9010" class="Symbol">)</a> <a id="9012" href="Axiom.Set.Map.html#4684" class="Function Operator">∪ᵐˡ</a> <a id="9016" href="Ledger.Utxo.html#2117" class="Function">outs</a> <a id="9021" href="Ledger.Utxo.html#8417" class="Bound">tx</a>
                        <a id="9048" href="Ledger.Utxo.html#4793" class="InductiveConstructor Operator">,</a> <a id="9050" href="Ledger.Utxo.html#8559" class="Bound">fees</a> <a id="9055" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="9057" href="Ledger.Transaction.html#3735" class="Field">txfee</a> <a id="9063" href="Ledger.Utxo.html#8417" class="Bound">tx</a>
                        <a id="9090" href="Ledger.Utxo.html#4793" class="InductiveConstructor Operator">,</a> <a id="9092" href="Ledger.Utxo.html#7093" class="Function">updateDeposits</a> <a id="9107" href="Ledger.Utxo.html#8472" class="Bound">pp</a> <a id="9110" href="Ledger.Utxo.html#8417" class="Bound">tx</a> <a id="9113" href="Ledger.Utxo.html#8602" class="Bound">deposits</a>
                        <a id="9146" href="Ledger.Utxo.html#4793" class="InductiveConstructor Operator">,</a> <a id="9148" href="Ledger.Utxo.html#8649" class="Bound">donations</a> <a id="9158" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="9160" href="Ledger.Transaction.html#3984" class="Field">txdonation</a> <a id="9171" href="Ledger.Utxo.html#8417" class="Bound">tx</a>
                        <a id="9198" href="Ledger.Utxo.html#4793" class="InductiveConstructor Operator">⟧ᵘ</a>
<a id="9201" class="Markup">\end{code}</a><a id="9211" class="Background">
</a><a id="9212" class="Markup">\begin{code}[hide]</a>
<a id="9231" class="Comment">-- TODO: This can&#39;t be moved into Properties because it breaks. Move</a>
<a id="9300" class="Comment">-- this once this is fixed.</a>
<a id="9328" class="Keyword">unquoteDecl</a> <a id="Computational-UTXO"></a><a id="9340" href="Ledger.Utxo.html#9340" class="Function">Computational-UTXO</a> <a id="9359" class="Symbol">=</a> <a id="9361" href="Tactic.DeriveComp.html#7204" class="Function">deriveComputational</a> <a id="9381" class="Symbol">(</a><a id="9382" class="Keyword">quote</a> <a id="9388" href="Ledger.Utxo.html#6291" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a><a id="9401" class="Symbol">)</a> <a id="9403" href="Ledger.Utxo.html#9340" class="Function">Computational-UTXO</a>
<a id="9422" class="Markup">\end{code}</a><a id="9432" class="Background">
\caption{UTXO inference rules}
\label{fig:rules:utxo-shelley}
\end{figure*}
</a></pre></body></html>