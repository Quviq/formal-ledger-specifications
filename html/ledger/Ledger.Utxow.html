<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Utxow</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\subsection{Witnessing}
</a><a id="25" class="Markup">\begin{code}[hide]</a>
<a id="44" class="Symbol">{-#</a> <a id="48" class="Keyword">OPTIONS</a> <a id="56" class="Pragma">--safe</a> <a id="63" class="Symbol">#-}</a>

<a id="68" class="Keyword">open</a> <a id="73" class="Keyword">import</a> <a id="80" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="100" class="Keyword">module</a> <a id="107" href="Ledger.Utxow.html" class="Module">Ledger.Utxow</a> <a id="120" class="Symbol">(</a><a id="121" href="Ledger.Utxow.html#121" class="Bound">txs</a> <a id="125" class="Symbol">:</a> <a id="127" href="Ledger.Transaction.html#549" class="Record">TransactionStructure</a><a id="147" class="Symbol">)</a> <a id="149" class="Keyword">where</a>

<a id="156" class="Keyword">open</a> <a id="161" class="Keyword">import</a> <a id="168" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="184" class="Keyword">import</a> <a id="191" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="202" class="Symbol">as</a> <a id="205" class="Module">M</a>
<a id="207" class="Keyword">import</a> <a id="214" href="Data.Nat.html" class="Module">Data.Nat</a>

<a id="224" class="Keyword">open</a> <a id="229" href="Ledger.Transaction.html#549" class="Module">TransactionStructure</a> <a id="250" href="Ledger.Utxow.html#121" class="Bound">txs</a>
<a id="254" class="Keyword">open</a> <a id="259" class="Keyword">import</a> <a id="266" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>
<a id="280" class="Keyword">open</a> <a id="285" class="Keyword">import</a> <a id="292" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="304" href="Ledger.Utxow.html#121" class="Bound">txs</a>

<a id="309" class="Keyword">open</a> <a id="314" href="Ledger.Transaction.html#3640" class="Module">TxBody</a>
<a id="321" class="Keyword">open</a> <a id="326" href="Ledger.Transaction.html#4177" class="Module">TxWitnesses</a>
<a id="338" class="Keyword">open</a> <a id="343" href="Ledger.Transaction.html#4273" class="Module">Tx</a>
<a id="346" class="Markup">\end{code}</a><a id="356" class="Background">

\begin{figure*}[h]
</a><a id="377" class="Markup">\begin{code}</a>
<a id="getVKeys"></a><a id="390" href="Ledger.Utxow.html#390" class="Function">getVKeys</a> <a id="399" class="Symbol">:</a> <a id="401" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="403" href="Ledger.Address.html#740" class="Function">Credential</a> <a id="414" class="Symbol">→</a> <a id="416" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="418" href="Ledger.Crypto.html#1812" class="Function">KeyHash</a>
<a id="426" href="Ledger.Utxow.html#390" class="Function">getVKeys</a> <a id="435" class="Symbol">=</a> <a id="437" href="Axiom.Set.html#7637" class="Function">mapPartial</a> <a id="448" href="Data.Sum.html#964" class="Function">isInj₁</a>

<a id="getScripts"></a><a id="456" href="Ledger.Utxow.html#456" class="Function">getScripts</a> <a id="467" class="Symbol">:</a> <a id="469" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="471" href="Ledger.Address.html#740" class="Function">Credential</a> <a id="482" class="Symbol">→</a> <a id="484" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="486" href="Ledger.Crypto.html#1750" class="Function">ScriptHash</a>
<a id="497" href="Ledger.Utxow.html#456" class="Function">getScripts</a> <a id="508" class="Symbol">=</a> <a id="510" href="Axiom.Set.html#7637" class="Function">mapPartial</a> <a id="521" href="Data.Sum.html#1047" class="Function">isInj₂</a>

<a id="credsNeeded"></a><a id="529" href="Ledger.Utxow.html#529" class="Function">credsNeeded</a> <a id="541" class="Symbol">:</a> <a id="543" href="Ledger.Transaction.html#3270" class="Function">UTxO</a> <a id="548" class="Symbol">→</a> <a id="550" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="557" class="Symbol">→</a> <a id="559" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="561" href="Ledger.Address.html#740" class="Function">Credential</a>
<a id="572" href="Ledger.Utxow.html#529" class="Function">credsNeeded</a> <a id="584" href="Ledger.Utxow.html#584" class="Bound">utxo</a> <a id="589" href="Ledger.Utxow.html#589" class="Bound">txb</a> <a id="593" class="Symbol">=</a>
    <a id="599" href="Axiom.Set.html#4924" class="Function">map</a> <a id="603" class="Symbol">(</a><a id="604" href="Ledger.Address.html#1894" class="Function">payCred</a> <a id="612" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="614" href="Data.Product.Base.html#608" class="Field">proj₁</a><a id="619" class="Symbol">)</a> <a id="621" class="Symbol">((</a><a id="623" href="Ledger.Utxow.html#584" class="Bound">utxo</a> <a id="628" href="Axiom.Set.Map.html#2261" class="Function Operator">ˢ</a><a id="629" class="Symbol">)</a> <a id="631" href="Axiom.Set.Rel.html#4564" class="Function Operator">⟪$⟫</a> <a id="635" href="Ledger.Transaction.html#3669" class="Field">txins</a> <a id="641" href="Ledger.Utxow.html#589" class="Bound">txb</a><a id="644" class="Symbol">)</a>
  <a id="648" href="Axiom.Set.html#8786" class="Function Operator">∪</a> <a id="650" href="Axiom.Set.html#4924" class="Function">map</a> <a id="654" href="Ledger.Deleg.html#1155" class="Function">cwitness</a> <a id="663" class="Symbol">(</a><a id="664" href="Ledger.Prelude.html#2334" class="Function">setFromList</a> <a id="676" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="678" href="Ledger.Transaction.html#3842" class="Field">txcerts</a> <a id="686" href="Ledger.Utxow.html#589" class="Bound">txb</a><a id="689" class="Symbol">)</a>
  <a id="693" href="Axiom.Set.html#8786" class="Function Operator">∪</a> <a id="695" href="Axiom.Set.html#4924" class="Function">map</a> <a id="699" href="Ledger.GovernanceActions.html#9193" class="Field">GovVote.credential</a> <a id="718" class="Symbol">(</a><a id="719" href="Ledger.Prelude.html#2334" class="Function">setFromList</a> <a id="731" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="733" href="Ledger.Transaction.html#3906" class="Field">txvote</a> <a id="740" href="Ledger.Utxow.html#589" class="Bound">txb</a><a id="743" class="Symbol">)</a>

<a id="witsVKeyNeeded"></a><a id="746" href="Ledger.Utxow.html#746" class="Function">witsVKeyNeeded</a> <a id="761" class="Symbol">:</a> <a id="763" href="Ledger.Transaction.html#3270" class="Function">UTxO</a> <a id="768" class="Symbol">→</a> <a id="770" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="777" class="Symbol">→</a> <a id="779" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="781" href="Ledger.Crypto.html#1812" class="Function">KeyHash</a>
<a id="789" href="Ledger.Utxow.html#746" class="Function">witsVKeyNeeded</a> <a id="804" href="Ledger.Utxow.html#804" class="Bound">utxo</a> <a id="809" class="Symbol">=</a> <a id="811" href="Ledger.Utxow.html#390" class="Function">getVKeys</a> <a id="820" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="822" href="Ledger.Utxow.html#529" class="Function">credsNeeded</a> <a id="834" href="Ledger.Utxow.html#804" class="Bound">utxo</a>

<a id="scriptsNeeded"></a><a id="840" href="Ledger.Utxow.html#840" class="Function">scriptsNeeded</a> <a id="854" class="Symbol">:</a> <a id="856" href="Ledger.Transaction.html#3270" class="Function">UTxO</a> <a id="861" class="Symbol">→</a> <a id="863" href="Ledger.Transaction.html#3640" class="Record">TxBody</a> <a id="870" class="Symbol">→</a> <a id="872" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="874" href="Ledger.Crypto.html#1750" class="Function">ScriptHash</a>
<a id="885" href="Ledger.Utxow.html#840" class="Function">scriptsNeeded</a> <a id="899" href="Ledger.Utxow.html#899" class="Bound">utxo</a> <a id="904" class="Symbol">=</a> <a id="906" href="Ledger.Utxow.html#456" class="Function">getScripts</a> <a id="917" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="919" href="Ledger.Utxow.html#529" class="Function">credsNeeded</a> <a id="931" href="Ledger.Utxow.html#899" class="Bound">utxo</a>

<a id="scriptsP1"></a><a id="937" href="Ledger.Utxow.html#937" class="Function">scriptsP1</a> <a id="947" class="Symbol">:</a> <a id="949" href="Ledger.Transaction.html#4177" class="Record">TxWitnesses</a> <a id="961" class="Symbol">→</a> <a id="963" href="Ledger.Prelude.html#1583" class="Function Operator">ℙ</a> <a id="965" href="Ledger.Script.html#471" class="Function">P1Script</a>
<a id="974" href="Ledger.Utxow.html#937" class="Function">scriptsP1</a> <a id="984" href="Ledger.Utxow.html#984" class="Bound">txw</a> <a id="988" class="Symbol">=</a> <a id="990" href="Axiom.Set.html#7637" class="Function">mapPartial</a> <a id="1001" href="Data.Sum.html#964" class="Function">isInj₁</a> <a id="1008" class="Symbol">(</a><a id="1009" href="Ledger.Transaction.html#4243" class="Field">scripts</a> <a id="1017" href="Ledger.Utxow.html#984" class="Bound">txw</a><a id="1020" class="Symbol">)</a>
<a id="1022" class="Markup">\end{code}</a><a id="1032" class="Background">
\caption{Functions used for witnessing}
\label{fig:functions:utxow}
\end{figure*}

\begin{figure*}[h]
</a><a id="1135" class="Markup">\begin{code}[hide]</a>
<a id="1154" class="Keyword">data</a>
<a id="1159" class="Markup">\end{code}</a><a id="1169" class="Background">
</a><a id="1170" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXOW⦈_"></a><a id="1185" href="Ledger.Utxow.html#1185" class="Datatype Operator">_⊢_⇀⦇_,UTXOW⦈_</a> <a id="1200" class="Symbol">:</a> <a id="1202" href="Ledger.Utxo.html#4636" class="Record">UTxOEnv</a> <a id="1210" class="Symbol">→</a> <a id="1212" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="1222" class="Symbol">→</a> <a id="1224" href="Ledger.Transaction.html#4273" class="Record">Tx</a> <a id="1227" class="Symbol">→</a> <a id="1229" href="Ledger.Utxo.html#4757" class="Record">UTxOState</a> <a id="1239" class="Symbol">→</a> <a id="1241" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="1245" class="Markup">\end{code}</a><a id="1255" class="Background">
\caption{UTxOW transition-system types}
\label{fig:ts-types:utxow}
\end{figure*}

\begin{figure*}[h]
</a><a id="1357" class="Markup">\begin{code}[hide]</a>
<a id="All′"></a><a id="1376" href="Ledger.Utxow.html#1376" class="Function">All′</a> <a id="1381" class="Symbol">=</a> <a id="1383" href="Axiom.Set.html#9486" class="Function">All</a>
<a id="1387" class="Keyword">syntax</a> <a id="1394" href="Ledger.Utxow.html#1376" class="Function">All′</a> <a id="1399" class="Symbol">(λ</a> <a id="1402" class="Bound">x</a> <a id="1404" class="Symbol">→</a> <a id="1406" class="Bound">P</a><a id="1407" class="Symbol">)</a> <a id="1409" class="Bound">l</a> <a id="1411" class="Symbol">=</a> <a id="1413" class="Function">∀[</a> <a id="1416" class="Bound">x</a> <a id="1418" class="Function">∈</a> <a id="1420" class="Bound">l</a> <a id="1422" class="Function">]</a> <a id="1424" class="Bound">P</a>
<a id="1426" class="Keyword">data</a> <a id="1431" href="Ledger.Utxow.html#1185" class="Datatype Operator">_⊢_⇀⦇_,UTXOW⦈_</a> <a id="1446" class="Keyword">where</a>
<a id="1452" class="Markup">\end{code}</a><a id="1462" class="Background">
</a><a id="1463" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXOW⦈_.UTXOW-inductive"></a><a id="1478" href="Ledger.Utxow.html#1478" class="InductiveConstructor">UTXOW-inductive</a> <a id="1494" class="Symbol">:</a>
    <a id="1500" class="Symbol">∀</a> <a id="1502" class="Symbol">{</a><a id="1503" href="Ledger.Utxow.html#1503" class="Bound">Γ</a><a id="1504" class="Symbol">}</a> <a id="1506" class="Symbol">{</a><a id="1507" href="Ledger.Utxow.html#1507" class="Bound">s</a><a id="1508" class="Symbol">}</a> <a id="1510" class="Symbol">{</a><a id="1511" href="Ledger.Utxow.html#1511" class="Bound">tx</a><a id="1513" class="Symbol">}</a> <a id="1515" class="Symbol">{</a><a id="1516" href="Ledger.Utxow.html#1516" class="Bound">s&#39;</a><a id="1518" class="Symbol">}</a>
    <a id="1524" class="Symbol">→</a> <a id="1526" class="Keyword">let</a> <a id="1530" href="Ledger.Utxow.html#1530" class="Bound">utxo</a> <a id="1535" class="Symbol">=</a> <a id="1537" href="Ledger.Utxo.html#4812" class="Field">UTxOState.utxo</a> <a id="1552" href="Ledger.Utxow.html#1507" class="Bound">s</a>
          <a id="1564" href="Ledger.Utxow.html#1564" class="Bound">txb</a> <a id="1568" class="Symbol">=</a> <a id="1570" href="Ledger.Transaction.html#4298" class="Field">body</a> <a id="1575" href="Ledger.Utxow.html#1511" class="Bound">tx</a>
          <a id="1588" href="Ledger.Utxow.html#1588" class="Bound">txw</a> <a id="1592" class="Symbol">=</a> <a id="1594" href="Ledger.Transaction.html#4323" class="Field">wits</a> <a id="1599" href="Ledger.Utxow.html#1511" class="Bound">tx</a>
          <a id="1612" href="Ledger.Utxow.html#1612" class="Bound">witsKeyHashes</a> <a id="1626" class="Symbol">=</a> <a id="1628" href="Axiom.Set.html#4924" class="Function">map</a> <a id="1632" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="1637" class="Symbol">(</a><a id="1638" href="Axiom.Set.Rel.html#1551" class="Function">dom</a> <a id="1642" class="Symbol">(</a><a id="1643" href="Ledger.Transaction.html#4211" class="Field">vkSigs</a> <a id="1650" href="Ledger.Utxow.html#1588" class="Bound">txw</a> <a id="1654" href="Axiom.Set.Map.html#2261" class="Function Operator">ˢ</a><a id="1655" class="Symbol">))</a>
          <a id="1668" href="Ledger.Utxow.html#1668" class="Bound">witsScriptHashes</a> <a id="1685" class="Symbol">=</a> <a id="1687" href="Axiom.Set.html#4924" class="Function">map</a> <a id="1691" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="1696" class="Symbol">(</a><a id="1697" href="Ledger.Transaction.html#4243" class="Field">scripts</a> <a id="1705" href="Ledger.Utxow.html#1588" class="Bound">txw</a><a id="1708" class="Symbol">)</a>
      <a id="1716" class="Keyword">in</a>
    <a id="1723" href="Ledger.Utxow.html#1376" class="Function">∀[</a> <a id="1726" href="Ledger.Utxow.html#1726" class="Bound">(</a><a id="1727" href="Ledger.Utxow.html#1727" class="Bound">vk</a> <a id="1730" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1732" href="Ledger.Utxow.html#1732" class="Bound">σ</a><a id="1733" href="Ledger.Utxow.html#1726" class="Bound">)</a> <a id="1735" href="Ledger.Utxow.html#1376" class="Function">∈</a> <a id="1737" href="Ledger.Transaction.html#4211" class="Field">vkSigs</a> <a id="1744" href="Ledger.Utxow.html#1588" class="Bound">txw</a> <a id="1748" href="Axiom.Set.Map.html#2261" class="Function Operator">ˢ</a> <a id="1750" href="Ledger.Utxow.html#1376" class="Function">]</a> <a id="1752" href="Ledger.Crypto.html#994" class="Function">isSigned</a> <a id="1761" href="Ledger.Utxow.html#1727" class="Bound">vk</a> <a id="1764" class="Symbol">(</a><a id="1765" href="Ledger.Transaction.html#2046" class="Field">txidBytes</a> <a id="1775" class="Symbol">(</a><a id="1776" href="Ledger.Transaction.html#4148" class="Field">txid</a> <a id="1781" href="Ledger.Utxow.html#1564" class="Bound">txb</a><a id="1784" class="Symbol">))</a> <a id="1787" href="Ledger.Utxow.html#1732" class="Bound">σ</a>
    <a id="1793" class="Symbol">→</a> <a id="1795" href="Ledger.Utxow.html#1376" class="Function">∀[</a> <a id="1798" href="Ledger.Utxow.html#1798" class="Bound">s</a> <a id="1800" href="Ledger.Utxow.html#1376" class="Function">∈</a> <a id="1802" href="Ledger.Utxow.html#937" class="Function">scriptsP1</a> <a id="1812" href="Ledger.Utxow.html#1588" class="Bound">txw</a> <a id="1816" href="Ledger.Utxow.html#1376" class="Function">]</a> <a id="1818" href="Ledger.Script.html#494" class="Function">validP1Script</a> <a id="1832" href="Ledger.Utxow.html#1612" class="Bound">witsKeyHashes</a> <a id="1846" class="Symbol">(</a><a id="1847" href="Ledger.Transaction.html#3794" class="Field">txvldt</a> <a id="1854" href="Ledger.Utxow.html#1564" class="Bound">txb</a><a id="1857" class="Symbol">)</a> <a id="1859" href="Ledger.Utxow.html#1798" class="Bound">s</a>
    <a id="1865" class="Symbol">→</a> <a id="1867" href="Ledger.Utxow.html#746" class="Function">witsVKeyNeeded</a> <a id="1882" href="Ledger.Utxow.html#1530" class="Bound">utxo</a> <a id="1887" href="Ledger.Utxow.html#1564" class="Bound">txb</a> <a id="1891" href="Axiom.Set.html#1889" class="Function Operator">⊆</a> <a id="1893" href="Ledger.Utxow.html#1612" class="Bound">witsKeyHashes</a>
    <a id="1911" class="Symbol">→</a> <a id="1913" href="Ledger.Utxow.html#840" class="Function">scriptsNeeded</a> <a id="1927" href="Ledger.Utxow.html#1530" class="Bound">utxo</a> <a id="1932" href="Ledger.Utxow.html#1564" class="Bound">txb</a> <a id="1936" href="Axiom.Set.html#2548" class="Function Operator">≡ᵉ</a> <a id="1939" href="Ledger.Utxow.html#1668" class="Bound">witsScriptHashes</a>
    <a id="1960" class="Symbol">→</a> <a id="1962" href="Ledger.Transaction.html#4047" class="Field">txADhash</a> <a id="1971" href="Ledger.Utxow.html#1564" class="Bound">txb</a> <a id="1975" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1977" href="Data.Maybe.Base.html#2035" class="Function">M.map</a> <a id="1983" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="1988" class="Symbol">(</a><a id="1989" href="Ledger.Transaction.html#4353" class="Field">txAD</a> <a id="1994" href="Ledger.Utxow.html#1511" class="Bound">tx</a><a id="1996" class="Symbol">)</a>
    <a id="2002" class="Symbol">→</a> <a id="2004" href="Ledger.Utxow.html#1503" class="Bound">Γ</a> <a id="2006" href="Ledger.Utxo.html#6291" class="Datatype Operator">⊢</a> <a id="2008" href="Ledger.Utxow.html#1507" class="Bound">s</a> <a id="2010" href="Ledger.Utxo.html#6291" class="Datatype Operator">⇀⦇</a> <a id="2013" href="Ledger.Utxow.html#1564" class="Bound">txb</a> <a id="2017" href="Ledger.Utxo.html#6291" class="Datatype Operator">,UTXO⦈</a> <a id="2024" href="Ledger.Utxow.html#1516" class="Bound">s&#39;</a>
    <a id="2031" href="Interface.STS.html#211" class="Function Operator">────────────────────────────────</a>
    <a id="2068" href="Ledger.Utxow.html#1503" class="Bound">Γ</a> <a id="2070" href="Ledger.Utxow.html#1185" class="Datatype Operator">⊢</a> <a id="2072" href="Ledger.Utxow.html#1507" class="Bound">s</a> <a id="2074" href="Ledger.Utxow.html#1185" class="Datatype Operator">⇀⦇</a> <a id="2077" href="Ledger.Utxow.html#1511" class="Bound">tx</a> <a id="2080" href="Ledger.Utxow.html#1185" class="Datatype Operator">,UTXOW⦈</a> <a id="2088" href="Ledger.Utxow.html#1516" class="Bound">s&#39;</a>
<a id="2091" class="Markup">\end{code}</a><a id="2101" class="Background">
\caption{UTXOW inference rules}
\label{fig:rules:utxow}
\end{figure*}
</a></pre></body></html>